<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æœ¬åœ°è‡ªæ®ºæ–°èç›£æ¸¬ç«™ (UXå¼·åŒ–ç‰ˆ - ä¸‰æ¬„ä¸¦æ’)</title>
    
    <style>
        /* --------------------------------- */
        /* --- ğŸ¨ æ ¸å¿ƒé¡è‰²è®Šé‡ (Light/Dark Mode) --- */
        /* --------------------------------- */
        :root {
            /* Light Mode Defaults */
            --bg-color: #f4f7f9;
            --container-bg: white;
            --text-color: #2c3e50;
            --text-muted: #7f8c8d;
            --border-color: #e0e6ed;
            --hover-bg: #f0f0f0;
            --shadow-light: 0 1px 4px rgba(0, 0, 0, 0.05);
            --shadow-heavy: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.08);
            --primary-color: #3498db; 
            
            /* Status Tags (æŸ”å’ŒåŒ–é¡è‰²) */
            --tag-death-bg: #f5caca; /* æ·ºç´… */
            --tag-attempt-bg: #c9f0d1; /* æ·ºç¶  */
            --tag-ambiguous-bg: #fcf4cf; /* æ·ºé»ƒ */
            --tag-district-bg: #f0f0f0; /* åœ°å€æ¨™ç±¤çš„èƒŒæ™¯è‰² */

            /* New & Highlight */
            --highlight-bg: #ffeb3b;
            --tag-new-bg: #e67e22; /* æ©™è‰² */
        }

        /* --------------------------------- */
        /* --- ğŸŒ™ Dark Mode Styles --- */
        /* --------------------------------- */
        body.dark-mode {
            --bg-color: #121212;
            --container-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-muted: #9e9e9e;
            --border-color: #333333;
            --hover-bg: #2a2a2a;
            --shadow-light: 0 1px 4px rgba(0, 0, 0, 0.3);
            --shadow-heavy: 0 8px 15px rgba(0, 0, 0, 0.5);
            --primary-color: #5d9cec;
            
            --tag-death-bg: #5c3c3c; 
            --tag-attempt-bg: #3c5c3c; 
            --tag-ambiguous-bg: #5c5c3c;
            --tag-district-bg: #333333; /* Dark Mode åœ°å€æ¨™ç±¤çš„èƒŒæ™¯è‰² */
            
            --highlight-bg: #a37200; /* æ·±é»ƒ */
            --tag-new-bg: #d35400; 
        }

        /* --------------------------------- */
        /* --- General & Base Styles --- */
        /* --------------------------------- */
        body {
            font-family: "PingFang TC", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: var(--bg-color); 
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            scroll-behavior: smooth; 
            transition: background-color 0.3s, color 0.3s; 
        }
        
        .alert-bar {
            background-color: #e74c3c;
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 1rem;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        
        .header {
            text-align: center;
            padding: 30px 20px 20px;
            background: var(--container-bg);
            margin-bottom: 25px;
            box-shadow: var(--shadow-light); 
            position: relative; 
            transition: background-color 0.3s;
        }
        .header h1 { margin: 0 0 5px 0; font-size: 2.2rem; font-weight: 800; }
        .header .meta { 
            color: var(--text-muted);
            font-size: 0.95rem;
            font-style: italic;
        }
        .info-widget {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            color: var(--text-color);
            font-size: 0.95rem;
            line-height: 1.5;
            z-index: 5;
            font-weight: 600;
        }
        #mode-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.4rem;
            padding: 5px;
            margin-left: 15px;
            color: var(--text-color);
            transition: color 0.3s;
        }
        #mode-toggle:hover {
            color: var(--primary-color);
        }

        /* --------------------------------- */
        /* --- ğŸ¨ ç¯©é¸æ§åˆ¶é …æ¨£å¼ (Controls) --- */
        /* --------------------------------- */
        .controls-wrapper {
            max-width: 1000px;
            margin: 0 auto;
        }

        .controls-toggle {
            display: none; 
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
        }

        .controls {
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center; 
            gap: 25px;
            flex-wrap: wrap;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out; 
        }
        .controls.collapsed {
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            opacity: 0;
        }

        .controls label { font-weight: 700; color: var(--text-color); margin-right: 5px; align-self: center; }
        .controls select, .controls input[type="text"] {
            padding: 10px 12px;
            border-radius: 6px; 
            border: 1px solid var(--border-color);
            background-color: var(--container-bg);
            color: var(--text-color);
            font-size: 1rem;
            min-width: 130px;
            flex-grow: 1; 
            max-width: 320px;
            transition: border-color 0.2s, box-shadow 0.2s, background-color 0.2s, color 0.3s; 
            box-sizing: border-box;
        }
        .controls select:focus, .controls input[type="text"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        /* Active Filter Indicator & Flash Animation */
        .controls select.active-control, 
        .controls input[type="text"].active-control {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px var(--primary-color)33; 
            background-color: var(--hover-bg); 
        }
        .flash-active {
            animation: filterFlash 0.4s ease-out;
        }
        @keyframes filterFlash {
            0% { box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.5); }
            100% { box-shadow: none; }
        }

        /* æ´»å‹•ç¯©é¸å™¨ç¸½çµ */
        #active-filters-summary {
            margin-top: -10px;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: var(--hover-bg);
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.95rem;
            text-align: left;
            opacity: 0;
            transition: opacity 0.3s, background-color 0.3s;
            max-width: 960px;
            margin-left: auto;
            margin-right: auto;
        }
        #active-filters-summary.visible {
            opacity: 1;
        }
        
        /* --------------------------------- */
        /* --- åˆ—è¡¨å®¹å™¨æ¨£å¼ (Container) - æ ¸å¿ƒä¿®æ”¹ --- */
        /* --------------------------------- */
        .container {
            display: flex; /* å•Ÿç”¨ Flexbox */
            gap: 25px; /* æ¬„ç›®é–“è· */
            max-width: 1300px; /* å¢åŠ æœ€å¤§å¯¬åº¦ä»¥å®¹ç´ä¸‰æ¬„ */
            margin: 0 auto 50px auto; /* å±…ä¸­å’Œåº•éƒ¨é–“è· */
            padding: 0 20px; /* å·¦å³å…§é‚Šè· */
            align-items: stretch; /* ç¢ºä¿ä¸‰å€‹æ¬„ç›®é«˜åº¦ä¸€è‡´ */
        }

        /* --------------------------------- */
        /* --- åˆ—è¡¨æ¨£å¼èˆ‡å–®æ¬„å…§éƒ¨æ»¾å‹• --- */
        /* --------------------------------- */
        .source-column {
            background: var(--container-bg);
            border-radius: 12px; 
            overflow: hidden;
            box-shadow: var(--shadow-heavy); 
            transition: background-color 0.3s, transform 0.3s ease;
            display: flex; 
            flex-direction: column;
            min-height: 400px;
            
            /* è®“ä¸‰å€‹æ¬„ç›®å¹³å‡åˆ†é…å¯¬åº¦ */
            flex: 1 1 33%; 
        }
        
        .source-column:hover {
            transform: translateY(-3px); 
        }

        .column-header {
            padding: 18px 15px;
            color: white;
            font-weight: 700;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-shrink: 0; 
        }
        .column-header span.count {
            font-size: 1.1rem;
            font-weight: 900;
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
        }
        
        /* åª’é«”ä¸»é¡Œè‰² (ä¿æŒä¸è®Š) */
        .header-hk01 { background-color: #34495e; } 
        .header-oncc { background-color: #f39c12; } 
        .header-singtao { background-color: #e74c3c; } 

        /* å–®æ¬„å…§éƒ¨æ»¾å‹•å®¹å™¨ */
        .news-list {
            padding: 20px;
            overflow-y: auto; 
            max-height: 70vh; /* æœ€å¤§é«˜åº¦ï¼Œå¯æ ¹æ“šéœ€æ±‚èª¿æ•´ */
            min-height: 250px;
            flex-grow: 1;
            transition: opacity 0.4s ease-in-out; 
        }
        
        /* å…§å®¹æ·¡å…¥æ•ˆæœçš„å®¹å™¨ */
        .news-list-content.fade-in {
            opacity: 1;
        }
        .news-list-content {
            opacity: 0; 
            transition: opacity 0.4s ease-in-out;
        }

        /* --------------------------------- */
        /* --- æ–°èé …ç›®æ¨£å¼èˆ‡æ¨™ç±¤ --- (å·²ä¿®æ”¹) */
        /* --------------------------------- */
        
        .status-tag {
            display: inline-block;
            padding: 3px 8px; /* æ¨™ç±¤å…§é‚Šè· */
            margin-right: 8px; 
            margin-top: 4px; /* ç¨å¾®èˆ‡æ—¥æœŸåˆ†é–‹ */
            border-radius: 4px; 
            font-size: 0.85rem; 
            font-weight: 600; 
            white-space: nowrap;
            transition: background-color 0.3s, color 0.3s;
        }

        /* ç‹€æ…‹æ¨™ç±¤é¡è‰²æ‡‰ç”¨ */
        .tag-death {
            background-color: var(--tag-death-bg);
            color: var(--text-color); /* ç¢ºä¿æ·ºè‰²èƒŒæ™¯ä¸‹æ–‡å­—å¯è®€ */
        }
        .tag-attempt {
            background-color: var(--tag-attempt-bg);
            color: var(--text-color);
        }
        .tag-ambiguous {
            background-color: var(--tag-ambiguous-bg);
            color: var(--text-color);
        }
        .tag-district {
            /* é è¨­åœ°å€æ¨™ç±¤ç”¨é‚Šç•Œè‰²æˆ–æ›´ä¸­æ€§çš„é¡è‰² */
            background-color: var(--tag-district-bg); 
            color: var(--text-color);
        }

        .news-item {
            display: block;
            padding: 15px 5px;
            margin-bottom: 15px; 
            border-bottom: 1px solid var(--border-color); 
            text-decoration: none;
            color: var(--text-color);
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); 
        }
        
        .news-item:hover {
            background-color: var(--hover-bg); 
            transform: translateY(-2px); 
            box-shadow: var(--shadow-heavy); 
        }

        .news-title {
            font-size: 1.3rem; 
            font-weight: 700;
            line-height: 1.4;
            margin-top: 5px;
        }

        /* æœç´¢é—œéµè©é«˜äº® */
        .highlight-term {
            background-color: var(--highlight-bg); 
            color: var(--text-color);
            padding: 1px 3px;
            border-radius: 3px;
            font-weight: 800;
        }
        body.dark-mode .highlight-term {
            background-color: var(--highlight-bg); 
            color: var(--bg-color);
        }
        
        /* ã€Œæ–°ã€é …ç›®æŒ‡ç¤ºå™¨ */
        .tag-new {
            background-color: var(--tag-new-bg);
            color: white; /* æ©™è‰²èƒŒæ™¯é…ç™½è‰²å­—é«” */
            font-weight: 800;
            animation: pulseNew 2s infinite;
        }
        @keyframes pulseNew {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* éª¨æ¶å± */
        .skeleton-item {
            padding: 15px 5px;
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border-color); 
        }
        .skeleton-line {
            background-color: var(--border-color);
            height: 10px;
            border-radius: 3px;
            margin-bottom: 8px;
            animation: pulse 1.5s infinite ease-in-out;
        }

        /* --------------------------------- */
        /* --- éŸ¿æ‡‰å¼è¨­è¨ˆ (RWD) å„ªåŒ– --- */
        /* --------------------------------- */
        
        /* 1024px ä»¥ä¸‹ï¼šä¸‰æ¬„è®Šç‚ºå‚ç›´å †ç–Š */
        @media (max-width: 1024px) { 
            .container {
                flex-direction: column; /* å‚ç›´å †ç–Š */
                gap: 30px; 
                max-width: 700px; 
                padding: 0 15px;
            }
            
            .source-column {
                flex: 1 1 auto; 
                min-height: auto; 
            }
        }
        
        /* 768px ä»¥ä¸‹ï¼šæ‰‹æ©Ÿæ¨£å¼ */
        @media (max-width: 768px) {
            .controls-toggle {
                display: block; /* é¡¯ç¤ºæ”¶åˆæŒ‰éˆ• */
            }
            .controls {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
                align-items: flex-start;
                max-height: 0;
                overflow: hidden;
                padding-top: 0;
                padding-bottom: 0;
                margin-top: 0;
                margin-bottom: 0;
                opacity: 0;
            }
            .controls.expanded {
                max-height: 1000px; 
                opacity: 1;
                padding-top: 15px;
                padding-bottom: 15px;
                margin-top: 20px;
                margin-bottom: 20px;
            }
            .controls label, .controls select, .controls .search-wrapper, .controls .reset-button {
                width: 100%;
                margin-right: 0;
                box-sizing: border-box;
            }
            .info-widget {
                top: 15px;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                width: 90%;
            }
            #active-filters-summary {
                margin-top: 10px;
            }
            /* è®“æ‰‹æ©Ÿç«¯çš„å–®æ¬„æ»¾å‹•é«˜åº¦æ›´çŸ­ï¼Œæ¸›å°‘é é¢æ»¾å‹• */
            .news-list {
                max-height: 50vh; 
            }
        }
    </style>
</head>
<body>

    <div class="alert-bar">
        âš ï¸ çæƒœç”Ÿå‘½ï¼Œè«‹å°‹æ±‚å”åŠ©ï¼š2389 2222 (é¦™æ¸¯æ’’ç‘ªåˆ©äºé˜²æ­¢è‡ªæ®ºæœƒ) | 2382 0000 (ç”Ÿå‘½ç†±ç·š)
    </div>

    <div class="header">
        
        <div class="info-widget">
            <div id="current-date-time" class="date-time">
                è¼‰å…¥æ™‚é–“ä¸­...
                <button id="mode-toggle" title="åˆ‡æ›æ·±è‰²/æ·ºè‰²æ¨¡å¼">ğŸŒ™</button>
            </div>
            <div id="current-weather" class="weather">è¼‰å…¥å¤©æ°£ä¸­...</div>
            <div id="cache-status" class="cache-status"></div>
        </div>
        
        <h1>é¦™æ¸¯æœ¬åœ°è‡ªæ®ºæ–°èç›£æ¸¬ç«™</h1>
        
        <div class="controls-wrapper">
            <button id="controls-toggle-btn" class="controls-toggle">
                ğŸ”½ å±•é–‹ç¯©é¸èˆ‡æœç´¢
            </button>
            
            <div id="controls-area" class="controls">
                <label for="status-filter">ç‹€æ…‹ç¯©é¸ï¼š</label>
                <select id="status-filter" aria-label="ç¯©é¸æ–°èç‹€æ…‹">
                    <option value="all">æ‰€æœ‰ç‹€æ…‹</option>
                    <option value="death">ğŸ”´ è‡ªæ®ºèº«äº¡</option>
                    <option value="attempt">ğŸŸ¢ ä¼åœ–è‡ªæ®º</option>
                    <option value="ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</option>
                </select>

                <label for="district-filter">åœ°å€ç¯©é¸ï¼š</label>
                <select id="district-filter" aria-label="ç¯©é¸åœ°å€">
                    <option value="all">æ‰€æœ‰åœ°å€ (18å€)</option>
                    <option value="æ¸¯å³¶">æ¸¯å³¶ (ä¸­è¥¿/ç£ä»”/æ±å€/å—å€)</option>
                    <option value="ä¹é¾">ä¹é¾ (æ²¹å°–æ—º/æ·±æ°´åŸ—/ä¹é¾åŸ/é»ƒå¤§ä»™/è§€å¡˜)</option>
                    <option value="æ–°ç•Œ">æ–°ç•Œ (è‘µé’/èƒç£/å±¯é–€/å…ƒæœ—/åŒ—å€/å¤§åŸ”/æ²™ç”°/è¥¿è²¢)</option>
                    <option value="é›¢å³¶">é›¢å³¶</option>
                </select>

                <label for="sort-order">æ’åºæ–¹å¼ï¼š</label>
                <select id="sort-order" aria-label="æ–°èæ’åºæ–¹å¼">
                    <option value="newest">ç”±æœ€æ–°æ’åº</option>
                    <option value="oldest">ç”±æœ€èˆŠæ’åº</option>
                </select>
                
                <div class="search-wrapper">
                    <input type="text" id="keyword-search" placeholder="ğŸ” æœç´¢æ¨™é¡Œé—œéµå­—..." title="è¼¸å…¥ä»»ä½•é—œéµå­—æœç´¢" aria-label="é—œéµå­—æœç´¢æ¬„">
                    <button type="button" id="clear-search-btn" class="clear-button" aria-label="æ¸…ç©ºæœç´¢å…§å®¹">Ã—</button>
                </div>
                <button type="button" id="reset-filters-btn" class="reset-button" aria-label="é‡ç½®æ‰€æœ‰ç¯©é¸æ¢ä»¶">
                    ğŸ§¹ é‡ç½®
                </button>
            </div>
            
            <div id="active-filters-summary"></div>
        </div>


        <div class="meta">
            å°ˆæ³¨æ–¼ HK01ã€æ±ç¶²ã€æ˜Ÿå³¶çªç™¼æ–°è Â· é¡¯ç¤ºæœ€è¿‘ 7 æ—¥æ•¸æ“š
        </div>
        <div class="meta" id="last-update">æ­£åœ¨æº–å‚™...</div>
    </div>

    <div class="container">
        <div class="source-column">
            <div class="column-header header-singtao" id="header-list-singtao">ğŸ“° æ˜Ÿå³¶æ—¥å ± (çªç™¼å°ˆæ³¨) <span class="count">0</span></div>
            <div id="list-singtao" class="news-list"></div>
        </div>

        <div class="source-column">
            <div class="column-header header-oncc" id="header-list-oncc">ğŸŒ æ±ç¶² (On.cc) <span class="count">0</span></div>
            <div id="list-oncc" class="news-list"></div>
        </div>

        <div class="source-column">
            <div class="column-header header-hk01" id="header-list-hk01">ğŸ“± HK01 <span class="count">0</span></div>
            <div id="list-hk01" class="news-list"></div>
        </div>
    </div>

    <button id="back-to-top-btn" class="back-to-top" aria-label="è¿”å›é é¢é ‚éƒ¨">â¬†ï¸</button>

    <script>
        // -----------------------------------------------------
        // æ ¸å¿ƒæ•¸æ“šèˆ‡é…ç½®
        // -----------------------------------------------------
        let ALL_NEWS_DATA = {}; 
        const CACHE_KEY = 'hk_suicide_news_cache';
        const CACHE_TIMESTAMP_KEY = 'hk_suicide_news_timestamp';
        let LAST_UPDATE_TIMESTAMP = null; 

        const BASE_KEYWORDS = '(è‡ªæ®º OR è¼•ç”Ÿ OR å°‹æ­» OR å°‹çŸ­ OR å¢®æ¨“ OR è·³æ¨“ OR ç‡’ç‚­ OR å€’è‡¥ OR å±é«”ç™¼ç¾ OR æµ®å± OR é£Ÿè€é¼ è—¥ OR å‰²è„ˆ OR æœè—¥ OR åŠé ¸ OR æŠ•æ²³ OR æŠ•æµ· OR æœæ¯’ OR ä¼è·³ OR å¤©å°) (é¦™æ¸¯ OR æœ¬åœ° OR æ¸¯å³¶ OR ä¹é¾ OR æ–°ç•Œ OR é›¢å³¶) when:7d';
        const SUICIDE_KEYWORDS = ['è‡ªæ®º', 'è¼•ç”Ÿ', 'å°‹æ­»', 'å°‹çŸ­', 'å¢®æ¨“', 'è·³æ¨“', 'ç‡’ç‚­', 'å€’è‡¥', 'å±é«”ç™¼ç¾', 'æµ®å±', 'é£Ÿè€é¼ è—¥', 'æœé£Ÿ', 'å‰²è„ˆ', 'å‰²è…•', 'åŠé ¸', 'æŠ•æ²³', 'æŠ•æµ·', 'æœæ¯’', 'ä¼è·³', 'å¤©å°', 'å°‹çŸ­è¦‹', 'å‰²å‚·'];
        const EXCLUDE_WORDS = ['æ¨“å¸‚', 'è‚¡å¸‚', 'å¤§è·Œ', 'åŠ‡é€', 'æ‹æˆ²', 'æ”¶è¦–', 'è‚¡åƒ¹', 'æˆäº¤', 'æ¥­ä¸»', 'åäºº', 'ç¶“æ¿Ÿ', 'é‡‘è', 'æŠ•è³‡', 'ç§‘ä¼', 'å•†æ¥­åŒ–', 'ç§‘æŠ€åœ’', 'å¯Œå£«åº·', 'åŸºé‡‘', 'IPO', 'ä¸Šå¸‚', 'å‚µåˆ¸', 'æŒ‡æ•¸', 'åŒ¯ç‡', 'æ¨“åƒ¹', 'ç§Ÿé‡‘', 'è²·è³£', 'å‰µæ¥­', 'å‰µç§‘', 'ç§‘æŠ€', 'å¨›æ¨‚', 'æ˜æ˜Ÿ', 'è—äºº', 'æ¼”å”±æœƒ', 'ç´…æ¯¯', 'æ™‚è£', 'é›»å½±', 'åŠ‡é›†', 'ç·‹è', 'æ™‚å°š', 'é¤é£²', 'æ—…éŠ', 'ç¾é£Ÿ', 'æ¼”å”±æœƒ', 'çƒéšŠ', 'æ³¢', 'æ¶ˆé˜²æ¼”ç¿’', 'ç«è­¦æ¼”ç¿’', 'æ•‘æ´æ¼”ç¿’', 'è­¦éšŠæ¼”ç¿’', 'é«”è‚²', 'æ•™è‚²', 'å¤§å­¸'];
        const DEATH_KEYWORDS = ['èº«äº¡', 'æ–ƒå‘½', 'å±é«”', 'ä¸æ²»', 'ç•¶å ´æ­»äº¡', 'è­‰å¯¦æ­»äº¡', 'æ­»äº¡', 'äº¡', 'è¿”é­‚ä¹è¡“', 'ä¼å±', 'æ®å‘½', 'å€’æ–ƒ', 'é­‚æ–·', 'æµ®å±', 'æººæ–ƒ', 'è­‰å¯¦ä¸æ²»', 'èº«æ•…', 'çµ•å‘½']; 
        const ATTEMPT_KEYWORDS = ['ä¼åœ–', 'ç²æ•‘', 'æ•‘å›', 'åˆ¶æ­¢', 'é€é™¢', 'å±å', 'å±ç«™', 'è‡ªæ®˜', 'å‰²è„ˆ', 'æœè—¥', 'æœæ¯’', 'å°‹çŸ­', 'æ¸…é†’', 'é€é™¢æ¶æ•‘', 'æ˜è¿·', 'ç‡’å‚·', 'å‹¸æœ', 'é€é™¢æ²»ç†', 'æ±‚é†«'];
        
        const DISTRICT_MAP = {
            'ä¸­è¥¿': 'ä¸­è¥¿å€', 'ä¸­ç’°': 'ä¸­è¥¿å€', 'åŠå±±': 'ä¸­è¥¿å€', 'è¥¿ç‡Ÿç›¤': 'ä¸­è¥¿å€', 'ä¸Šç’°': 'ä¸­è¥¿å€', 'å …å°¼åœ°åŸ': 'ä¸­è¥¿å€', 'è¥¿ç’°': 'ä¸­è¥¿å€', 'é‡‘é˜': 'ä¸­è¥¿å€', 'èˆ¬å’¸é“': 'ä¸­è¥¿å€', 'å±±é ‚': 'ä¸­è¥¿å€', 'å¤ªå¹³å±±': 'ä¸­è¥¿å€', 'çŸ³å¡˜å’€': 'ä¸­è¥¿å€', 'è–„æ‰¶æ—é“': 'ä¸­è¥¿å€', 'å …å°¼': 'ä¸­è¥¿å€', 'åœ‹éš›é‡‘èä¸­å¿ƒ': 'ä¸­è¥¿å€', 'çš‡åå¤§é“': 'ä¸­è¥¿å€', 'å¾·è¼”é“': 'ä¸­è¥¿å€', 'è·ææ´»é“': 'ä¸­è¥¿å€', 'æ‘©æ˜Ÿå¶º': 'ä¸­è¥¿å€', 'ç¶­å¤šåˆ©äºåŸ': 'ä¸­è¥¿å€', 'ç£ä»”': 'ç£ä»”å€', 'éŠ…é‘¼ç£': 'ç£ä»”å€', 'è·‘é¦¬åœ°': 'ç£ä»”å€', 'å¤§å‘': 'ç£ä»”å€', 'æƒæ¡¿åŸ”': 'ç£ä»”å€', 'ç¦®é “å±±': 'ç£ä»”å€', 'å¤©å': 'ç£ä»”å€', 'å‹µå¾·é‚¨': 'ç£ä»”å€', 'å´‡å…‰': 'ç£ä»”å€', 'æœƒå±•': 'ç£ä»”å€', 'éµé ¸': 'ç£ä»”å€', 'åˆ©åœ’': 'ç£ä»”å€', 'ç¶­å¤šåˆ©äºå…¬åœ’': 'ç£ä»”å€', 'éŠ…é‘¼ç£é“': 'ç£ä»”å€', 'çŸ³æ°´æ¸ è¡—': 'ç£ä»”å€', 'æ±å€': 'æ±å€', 'åŒ—è§’': 'æ±å€', 'é°‚é­šæ¶Œ': 'æ±å€', 'ç­²ç®•ç£': 'æ±å€', 'æŸ´ç£': 'æ±å€', 'è¥¿ç£æ²³': 'æ±å€', 'æèŠ±é‚¨': 'æ±å€', 'å°è¥¿ç£': 'æ±å€', 'åº·æ€¡èŠ±åœ’': 'æ±å€', 'åº·å±±èŠ±åœ’': 'æ±å€', 'å¤ªå¤åŸ': 'æ±å€', 'ç‚®å°å±±': 'æ±å€', 'è—ç£åŠå³¶': 'æ±å€', 'èˆˆè¯é‚¨': 'æ±å€', 'æ¼ç£é‚¨': 'æ±å€', 'ç’°ç¿ é‚¨': 'æ±å€', 'åŸå¸‚èŠ±åœ’': 'æ±å€', 'å’Œå¯Œä¸­å¿ƒ': 'æ±å€', 'å¤ªå¤åŠ': 'æ±å€', 'å—å€': 'å—å€', 'é»ƒç«¹å‘': 'å—å€', 'å¤§å£ç’°': 'å—å€', 'è–„æ‰¶æ—': 'å—å€', 'ç½®å¯Œ': 'å—å€', 'è¯å¯Œ': 'å—å€', 'è¯è²´': 'å—å€', 'é¦™æ¸¯ä»”': 'å—å€', 'ç”°ç£': 'å—å€', 'è²æ²™ç£': 'å—å€', 'æ•¸ç¢¼æ¸¯': 'å—å€', 'æ·ºæ°´ç£': 'å—å€', 'èµ¤æŸ±': 'å—å€', 'å¤§æ½­': 'å—å€', 'åˆ©æ±é‚¨': 'å—å€', 'æµ·æ€¡åŠå³¶': 'å—å€', 'é´¨è„·æ´²': 'å—å€', 'æ·±æ°´ç£': 'å—å€', 'çŸ³æ¾³': 'å—å€', 'å£½è‡£å±±': 'å—å€', 'æµ·æ´‹å…¬åœ’': 'å—å€', 'é´¨è„·': 'å—å€', 'ç¾åˆ©æ¨“': 'å—å€', 'æ²¹å°–æ—º': 'æ²¹å°–æ—ºå€', 'æ—ºè§’': 'æ²¹å°–æ—ºå€', 'æ²¹éº»åœ°': 'æ²¹å°–æ—ºå€', 'å°–æ²™å’€': 'æ²¹å°–æ—ºå€', 'å¤§è§’å’€': 'æ²¹å°–æ—ºå€', 'ä½æ•¦': 'æ²¹å°–æ—ºå€', 'å¥§é‹': 'æ²¹å°–æ—ºå€', 'å¯Œæ¦®èŠ±åœ’': 'æ²¹å°–æ—ºå€', 'æµ·å¯Œè‹‘': 'æ²¹å°–æ—ºå€', 'å»£æ±é“': 'æ²¹å°–æ—ºå€', 'åœ“æ–¹': 'æ²¹å°–æ—ºå€', 'è¥¿ä¹é¾ç«™': 'æ²¹å°–æ—ºå€', 'å½Œæ•¦é“': 'æ²¹å°–æ—ºå€', 'å¤ªå­': 'æ²¹å°–æ—ºå€', 'çª©æ‰“è€é“': 'æ²¹å°–æ—ºå€', 'ä¸­æ¸¯åŸ': 'æ²¹å°–æ—ºå€', 'æœ—è±ªåŠ': 'æ²¹å°–æ—ºå€', 'é›…è˜­': 'æ²¹å°–æ—ºå€', 'æ­·å²åšç‰©é¤¨': 'æ²¹å°–æ—ºå€', 'æ·±æ°´': 'æ·±æ°´åŸ—å€', 'é•·æ²™ç£': 'æ·±æ°´åŸ—å€', 'çŸ³ç¡¤å°¾': 'æ·±æ°´åŸ—å€', 'è”æè§’': 'æ·±æ°´åŸ—å€', 'ç¾å­š': 'æ·±æ°´åŸ—å€', 'å—å±±é‚¨': 'æ·±æ°´åŸ—å€', 'è˜‡å±‹é‚¨': 'æ·±æ°´åŸ—å€', 'ç™½ç”°é‚¨': 'æ·±æ°´åŸ—å€', 'éº—é–£é‚¨': 'æ·±æ°´åŸ—å€', 'æ¬½å·è¡—': 'æ·±æ°´åŸ—å€', 'åˆä¸€æ‘': 'æ·±æ°´åŸ—å€', 'æé„­å±‹': 'æ·±æ°´åŸ—å€', 'å…ƒå·é‚¨': 'æ·±æ°´åŸ—å€', 'å¯Œæ˜Œé‚¨': 'æ·±æ°´åŸ—å€', 'è¥¿ä¹é¾ä¸­å¿ƒ': 'æ·±æ°´åŸ—å€', 'é»ƒé‡‘é›»è…¦': 'æ·±æ°´åŸ—å€', 'å¸ƒè—å¸‚å ´': 'æ·±æ°´åŸ—å€', 'ä¹é¾åŸ': 'ä¹é¾åŸå€', 'ç´…ç£¡': 'ä¹é¾åŸå€', 'ä¹é¾å¡˜': 'ä¹é¾åŸå€', 'åœŸç“œç£': 'ä¹é¾åŸå€', 'ä½•æ–‡ç”°': 'ä¹é¾åŸå€', 'å•Ÿå¾·': 'ä¹é¾åŸå€', 'å•Ÿæ™´é‚¨': 'ä¹é¾åŸå€', 'å¾·æœ—é‚¨': 'ä¹é¾åŸå€', 'ç¿”é¾ç£': 'ä¹é¾åŸå€', 'æ„›æ°‘é‚¨': 'ä¹é¾åŸå€', 'é»ƒåŸ”': 'ä¹é¾åŸå€', 'æµ·é€¸è±ªåœ’': 'ä¹é¾åŸå€', 'åˆä¸€åŸ': 'ä¹é¾åŸå€', 'æµ¸å¤§': 'ä¹é¾åŸå€', 'ç†å¤§': 'ä¹é¾åŸå€', 'é¦¬é ­åœ': 'ä¹é¾åŸå€', 'é¦¬é ­è§’': 'ä¹é¾åŸå€', 'ä¹é¾ç£å…¬åœ’': 'ä¹é¾åŸå€', 'è’²å´—': 'ä¹é¾åŸå€', 'é»ƒå¤§ä»™': 'é»ƒå¤§ä»™å€', 'æ…ˆé›²å±±': 'é»ƒå¤§ä»™å€', 'æ¨‚å¯Œ': 'é»ƒå¤§ä»™å€', 'å½©è™¹': 'å½©è™¹é‚¨', 'é‘½çŸ³å±±': 'é»ƒå¤§ä»™å€', 'æ–°è’²å´—': 'é»ƒå¤§ä»™å€', 'ç«¹åœ’é‚¨': 'é»ƒå¤§ä»™å€', 'é³³å‡°æ–°é‚¨': 'é»ƒå¤§ä»™å€', 'æ–§å±±': 'é»ƒå¤§ä»™å€', 'é¾ç¿”é“': 'é»ƒå¤§ä»™å€', 'ç‰›æ± ç£': 'é»ƒå¤§ä»™å€', 'æ±é ­é‚¨': 'é»ƒå¤§ä»™å€', 'æ©«é ­ç£¡': 'é»ƒå¤§ä»™å€', 'å¤©é¦¬è‹‘': 'é»ƒå¤§ä»™å€', 'å½©é›²é‚¨': 'é»ƒå¤§ä»™å€', 'åªçŸ³é‚¨': 'é»ƒå¤§ä»™å€', 'å¿—è“®æ·¨è‹‘': 'é»ƒå¤§ä»™å€', 'å—è“®åœ’æ± ': 'é»ƒå¤§ä»™å€', 'ç…å­å±±å…¬åœ’': 'é»ƒå¤§ä»™å€', 'è§€å¡˜': 'è§€å¡˜å€', 'è—ç”°': 'è§€å¡˜å€', 'æ²¹å¡˜': 'è§€å¡˜å€', 'ç§€èŒ‚åª': 'è§€å¡˜å€', 'é †åˆ©': 'é †åˆ©é‚¨', 'æ¨‚è¯': 'è§€å¡˜å€', 'éº—æ™¶èŠ±åœ’': 'è§€å¡˜å€', 'å•Ÿæ¥­é‚¨': 'è§€å¡˜å€', 'é †å¤©é‚¨': 'è§€å¡˜å€', 'ç¿ å±é‚¨': 'è§€å¡˜å€', 'é¯‰é­šé–€': 'è§€å¡˜å€', 'å‰µç´€ä¹‹åŸ': 'è§€å¡˜å€', 'ç‰›é ­è§’': 'è§€å¡˜å€', 'ä¹é¾ç£': 'è§€å¡˜å€', 'å¾·ç¦èŠ±åœ’': 'è§€å¡˜å€', 'æ·˜å¤§èŠ±åœ’': 'è§€å¡˜å€', 'æ›‰éº—è‹‘': 'è§€å¡˜å€', 'é«˜ä¿Šè‹‘': 'è§€å¡˜å€', 'å®‰é”é‚¨': 'è§€å¡˜å€', 'å®‰æ³°é‚¨': 'è§€å¡˜å€', 'æ±ä¹æ–‡åŒ–ä¸­å¿ƒ': 'è§€å¡˜å€', 'ä½æ•¦è°·å…¬åœ’': 'è§€å¡˜å€', 'è‘µé’': 'è‘µé’å€', 'è‘µæ¶Œ': 'è‘µé’å€', 'é’è¡£': 'è‘µé’å€', 'è”æ™¯': 'è‘µé’å€', 'è‘µç››': 'è‘µé’å€', 'è‘µèŠ³': 'è‘µé’å€', 'é•·å®‰é‚¨': 'è‘µé’å€', 'é•·åº·é‚¨': 'è‘µé’å€', 'é’è¡£é‚¨': 'è‘µé’å€', 'é•·å®é‚¨': 'è‘µé’å€', 'é•·ç™¼é‚¨': 'è‘µé’å€', 'çŸ³ç±¬': 'è‘µé’å€', 'å¤§çª©å£': 'è‘µé’å€', 'è²¨æ«ƒç¢¼é ­': 'è‘µé’å€', 'é’è¡£æ©‹': 'è‘µé’å€', 'é’é¦¬å¤§æ©‹': 'è‘µé’å€', 'ç¾æ™¯èŠ±åœ’': 'è‘µé’å€', 'é’è¡£è‡ªç„¶å¾‘': 'è‘µé’å€', 'èƒç£': 'èƒç£å€', 'æ±€ä¹': 'èƒç£å€', 'æ·±äº•': 'èƒç£å€', 'é¦¬ç£': 'èƒç£å€', 'éº—åŸèŠ±åœ’': 'èƒç£å€', 'æ„‰æ™¯æ–°åŸ': 'èƒç£å€', 'ç¶ æ¥Šæ–°é‚¨': 'èƒç£å€', 'è±¡å±±é‚¨': 'èƒç£å€', 'ç¦ä¾†é‚¨': 'èƒç£å€', 'çŸ³åœè§’': 'èƒç£å€', 'æµ·ä¹‹æˆ€': 'èƒç£å€', 'èƒå¨': 'èƒç£å€', 'èƒæ™¯åœ': 'èƒç£å€', 'æ²¹æŸ‘é ­': 'èƒç£å€', 'æ±€ä¹æ©‹': 'èƒç£å€', 'å¤§å¸½å±±': 'èƒç£å€', 'å±¯é–€': 'å±¯é–€å€', 'å…†åº·': 'å±¯é–€å€', 'è´è¶ç£': 'å±¯é–€å€', 'å¤§èˆˆ': 'å±¯é–€å€', 'å‹æ„›é‚¨': 'å±¯é–€å€', 'å®‰å®šé‚¨': 'å±¯é–€å€', 'æ¹–æ™¯é‚¨': 'å±¯é–€å€', 'å±¯é–€ç¢¼é ­': 'å±¯é–€å€', 'è‰¯æ™¯é‚¨': 'å±¯é–€å€', 'ç”°æ™¯é‚¨': 'å±¯é–€å€', 'å¯¶ç”°': 'å±¯é–€å€', 'å±±æ™¯é‚¨': 'å±¯é–€å€', 'ä¸‰è–': 'å±¯é–€å€', 'ç½®æ¨‚': 'å±¯é–€å€', 'é»ƒé‡‘æµ·å²¸': 'å±¯é–€å€', 'å°æ¬–': 'å±¯é–€å€', 'è—åœ°': 'å±¯é–€å€', 'å¤§æ¬–': 'å±¯é–€å€', 'åƒå³¶æ¹–': 'å±¯é–€å€', 'å…ƒæœ—': 'å…ƒæœ—å€', 'å¤©æ°´åœ': 'å…ƒæœ—å€', 'éŒ¦ç”°': 'å…ƒæœ—å€', 'å…«é„‰': 'å…ƒæœ—å€', 'æ–°ç”°': 'å…ƒæœ—å€', 'å±å±±': 'å…ƒæœ—å€', 'æ©«æ´²': 'å…ƒæœ—å€', 'æœ—å±é‚¨': 'å…ƒæœ—å€', 'å¤©æ‚…é‚¨': 'å…ƒæœ—å€', 'é‡‡è‘‰åº­': 'å…ƒæœ—å€', 'æ´ªæ°´æ©‹': 'å…ƒæœ—å€', 'å»ˆæ‘': 'å…ƒæœ—å€', 'æµæµ®å±±': 'å…ƒæœ—å€', 'åŠ å·': 'å…ƒæœ—å€', 'éŒ¦ç¶‰': 'å…ƒæœ—å€', 'å¤§æ£ ': 'å…ƒæœ—å€', 'å¤©è€€é‚¨': 'å…ƒæœ—å€', 'å¤©ç‘é‚¨': 'å…ƒæœ—å€', 'åŒ—å€': 'åŒ—å€', 'ä¸Šæ°´': 'åŒ—å€', 'ç²‰å¶º': 'åŒ—å€', 'æ²™é ­è§’': 'åŒ—å€', 'æ‰“é¼“å¶º': 'åŒ—å€', 'å¤æ´': 'åŒ—å€', 'è¯æ˜é‚¨': 'åŒ—å€', 'å˜‰ç¦é‚¨': 'åŒ—å€', 'æ¸…æ²³é‚¨': 'åŒ—å€', 'ç¥¥è¯é‚¨': 'åŒ—å€', 'è¯å’Œå¢Ÿ': 'åŒ—å€', 'è´è¶å±±': 'åŒ—å€', 'çŸ³æ¹–å¢Ÿ': 'åŒ—å€', 'è»åœ°': 'åŒ—å€', 'åªè¼‹': 'åŒ—å€', 'æµæ°´éŸ¿': 'åŒ—å€', 'é¶´è—ª': 'åŒ—å€', 'å¤§åŸ”': 'å¤§åŸ”å€', 'å¤§åŸ”å¢Ÿ': 'å¤§åŸ”å€', 'å»£ç¦': 'å¤§åŸ”å€', 'ç™½çŸ³è§’': 'å¤§åŸ”å€', 'å¤§ç¾ç£': 'å¤§åŸ”å€', 'ç§‘å­¸åœ’': 'å¤§åŸ”å€', 'å¯Œå–„é‚¨': 'å¤§åŸ”å€', 'æ˜Œé‹ä¸­å¿ƒ': 'å¤§åŸ”å€', 'å¤§åŸ”ä¸­å¿ƒ': 'å¤§åŸ”å€', 'å¤ªå’Œ': 'å¤§åŸ”å€', 'å¯Œäº¨é‚¨': 'å¤§åŸ”å€', 'é‹é ­å¡˜': 'å¤§åŸ”å€', 'æ–°å³°èŠ±åœ’': 'å¤§åŸ”å€', 'åéœ²æ¸¯': 'å¤§åŸ”å€', 'æ²™ç”°': 'æ²™ç”°å€', 'é¦¬éå±±': 'æ²™ç”°å€', 'å¤§åœ': 'æ²™ç”°å€', 'ç«ç‚­': 'æ²™ç”°å€', 'å°ç€æº': 'æ²™ç”°å€', 'åŸé–€æ²³': 'æ²™ç”°å€', 'ç€æºé‚¨': 'æ²™ç”°å€', 'ç¦¾è¼‹é‚¨': 'æ²™ç”°å€', 'å»£æºé‚¨': 'æ²™ç”°å€', 'åšåº·é‚¨': 'æ²™ç”°å€', 'æ–°åŸå¸‚å»£å ´': 'æ²™ç”°å€', 'æ²™ç”°é¦¬å ´': 'æ²™ç”°å€', 'å¨çˆ¾æ–¯é†«é™¢': 'æ²™ç”°å€', 'æ„‰ç¿ è‹‘': 'æ²™ç”°å€', 'ç§¦çŸ³é‚¨': 'æ²™ç”°å€', 'ç©—ç¦¾è‹‘': 'æ²™ç”°å€', 'ç¢©é–€é‚¨': 'æ²™ç”°å€', 'çƒæºªæ²™': 'æ²™ç”°å€', 'æ†å®‰': 'æ²™ç”°å€', 'é¡¯å¾‘': 'æ²™ç”°å€', 'è¥¿è²¢': 'è¥¿è²¢å€', 'å°‡è»æ¾³': 'è¥¿è²¢å€', 'å‘å£': 'è¥¿è²¢å€', 'èª¿æ™¯å¶º': 'è¥¿è²¢å€', 'å¯¶ç³': 'è¥¿è²¢å€', 'å°šå¾·': 'è¥¿è²¢å€', 'æ—¥å‡ºåº·åŸ': 'è¥¿è²¢å€', 'ç¿ æ—é‚¨': 'è¥¿è²¢å€', 'æ™¯æ—é‚¨': 'è¥¿è²¢å€', 'å¥æ˜é‚¨': 'è¥¿è²¢å€', 'è¥¿è²¢ç¢¼é ­': 'è¥¿è²¢å€', 'è ”æ¶Œ': 'è¥¿è²¢å€', 'æ¸…æ°´ç£': 'è¥¿è²¢å€', 'ç§‘å¤§': 'è¥¿è²¢å€', 'å¯¶æ—é‚¨': 'è¥¿è²¢å€', 'åšå¾·é‚¨': 'è¥¿è²¢å€', 'èŒµæ€¡': 'è¥¿è²¢å€', 'ä½›å ‚é–€': 'è¥¿è²¢å€', 'å¤§å»Ÿç£': 'è¥¿è²¢å€', 'é›¢å³¶': 'é›¢å³¶å€', 'æ±æ¶Œ': 'é›¢å³¶å€', 'å¤§å¶¼å±±': 'é›¢å³¶å€', 'é•·æ´²': 'é›¢å³¶å€', 'å—ä¸«å³¶': 'é›¢å³¶å€', 'æ„‰æ™¯ç£': 'é›¢å³¶å€', 'åªæ´²': 'é›¢å³¶å€', 'æ¢…çª©': 'é›¢å³¶å€', 'å¤§æ¾³': 'é›¢å³¶å€', 'èµ¤é±²è§’': 'é›¢å³¶å€', 'æ©Ÿå ´': 'é›¢å³¶å€', 'é€¸æ±é‚¨': 'é›¢å³¶å€', 'æ˜‚åª': 'é›¢å³¶å€', 'æ¬£æ¾³': 'é›¢å³¶å€', 'æ¦•æ¨¹ç£': 'é›¢å³¶å€', 'ç´¢ç½Ÿç£': 'é›¢å³¶å€', 'è²æ¾³': 'é›¢å³¶å€', 'å¡˜ç¦': 'é›¢å³¶å€', 'è¿ªå£«å°¼': 'é›¢å³¶å€',
        };
        const SOURCES = [
            { id: 'list-hk01', site: 'hk01.com', name: 'HK01', querySuffix: '' },
            { id: 'list-oncc', site: 'on.cc', name: 'æ±ç¶² (On.cc)', querySuffix: '' },
            { id: 'list-singtao', site: 'stheadline.com', name: 'æ˜Ÿå³¶æ—¥å ±', querySuffix: 'çªç™¼' } 
        ];
        const STATUS_OPTIONS = {
            'death': 'ğŸ”´ è‡ªæ®ºèº«äº¡',
            'attempt': 'ğŸŸ¢ ä¼åœ–è‡ªæ®º',
            'ambiguous': 'ğŸŸ  å¾…å®š/æ¨¡ç³Š'
        };
        const REGION_OPTIONS = {
            'æ¸¯å³¶': 'æ¸¯å³¶ (ä¸­è¥¿/ç£ä»”/æ±å€/å—å€)',
            'ä¹é¾': 'ä¹é¾ (æ²¹å°–æ—º/æ·±æ°´åŸ—/ä¹é¾åŸ/é»ƒå¤§ä»™/è§€å¡˜)',
            'æ–°ç•Œ': 'æ–°ç•Œ (è‘µé’/èƒç£/å±¯é–€/å…ƒæœ—/åŒ—å€/å¤§åŸ”/æ²™ç”°/è¥¿è²¢)',
            'é›¢å³¶': 'é›¢å³¶'
        };

        // -----------------------------------------------------
        // UX/UI å‡½æ•¸ (ä¿æŒä¸è®Š)
        // -----------------------------------------------------
        function updateDateTime() {
            // ... (ä¿æŒä¸è®Š) ...
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-HK', { year: 'numeric', month: 'numeric', day: 'numeric', weekday: 'short' });
            const timeStr = now.toLocaleTimeString('zh-HK', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            
            const dateTimeElement = document.getElementById('current-date-time');
            if (dateTimeElement) {
                const button = dateTimeElement.querySelector('#mode-toggle');
                dateTimeElement.innerHTML = `${dateStr} ${timeStr}`;
                dateTimeElement.appendChild(button);
            }
        }
        
        function getSuicideStatusHtml(status) {
            if (status === 'death') return '<span class="status-tag tag-death">ğŸ”´ è‡ªæ®ºèº«äº¡</span>';
            if (status === 'attempt') return '<span class="status-tag tag-attempt">ğŸŸ¢ ä¼åœ–è‡ªæ®º</span>';
            return '<span class="status-tag tag-ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</span>';
        }

        function getDistrictTag(title) { 
            const sortedKeys = Object.keys(DISTRICT_MAP).sort((a, b) => b.length - a.length);
            let districtName = 'åœ°å€ä¸æ˜';

            for (const shortName of sortedKeys) {
                if (title.includes(shortName)) {
                    districtName = DISTRICT_MAP[shortName];
                    break;
                }
            }
            
            let region = 'æœªçŸ¥';
            if (['ä¸­è¥¿å€', 'ç£ä»”å€', 'æ±å€', 'å—å€'].includes(districtName)) region = 'æ¸¯å³¶';
            else if (['æ²¹å°–æ—ºå€', 'æ·±æ°´åŸ—å€', 'ä¹é¾åŸå€', 'é»ƒå¤§ä»™å€', 'è§€å¡˜å€'].includes(districtName)) region = 'ä¹é¾';
            else if (['è‘µé’å€', 'èƒç£å€', 'å±¯é–€å€', 'å…ƒæœ—å€', 'åŒ—å€', 'å¤§åŸ”å€', 'æ²™ç”°å€', 'è¥¿è²¢å€'].includes(districtName)) region = 'æ–°ç•Œ';
            else if (districtName === 'é›¢å³¶å€') region = 'é›¢å³¶';
            
            // ä½¿ç”¨ class="status-tag tag-district" ä¾†æ‡‰ç”¨èƒŒæ™¯è‰²
            return {
                html: `<span class="status-tag tag-district" data-region="${region}">${districtName}</span>`,
                region: region,
                district: districtName
            };
        }

        function populateDistrictFilter(data) {
            const select = document.getElementById('district-filter');
            const allItems = Object.values(data).flat();
            const uniqueDistricts = [...new Set(Object.values(DISTRICT_MAP))].sort();
            
            const districtCounts = allItems.reduce((acc, item) => {
                const { district } = getDistrictTag(item.title);
                acc[district] = (acc[district] || 0) + 1;
                return acc;
            }, {});
            
            const regionCounts = { 'æ¸¯å³¶': 0, 'ä¹é¾': 0, 'æ–°ç•Œ': 0, 'é›¢å³¶': 0 };
            allItems.forEach(item => {
                const { region } = getDistrictTag(item.title);
                if (regionCounts.hasOwnProperty(region)) {
                    regionCounts[region] += 1;
                }
            });

            // 1. æ›´æ–°å¤§å€é¸é …çš„æ•¸é‡
            select.querySelector('option[value="æ¸¯å³¶"]').textContent = `æ¸¯å³¶ (${regionCounts['æ¸¯å³¶']})`;
            select.querySelector('option[value="ä¹é¾"]').textContent = `ä¹é¾ (${regionCounts['ä¹é¾']})`;
            select.querySelector('option[value="æ–°ç•Œ"]').textContent = `æ–°ç•Œ (${regionCounts['æ–°ç•Œ']})`;
            select.querySelector('option[value="é›¢å³¶"]').textContent = `é›¢å³¶ (${regionCounts['é›¢å³¶']})`;


            // 2. ç§»é™¤æ‰€æœ‰å–®å€‹åœ°å€é¸é …
            const existingOptions = select.querySelectorAll('option[value]:not([value="all"]):not([value="æ¸¯å³¶"]):not([value="ä¹é¾"]):not([value="æ–°ç•Œ"]):not([value="é›¢å³¶"])');
            existingOptions.forEach(opt => opt.remove());

            // 3. æ·»åŠ æ–°çš„å–®å€‹åœ°å€é¸é … (å¸¶æœ‰æ•¸é‡)
            const lastRegionOption = select.querySelector('option[value="é›¢å³¶"]');
            
            uniqueDistricts.forEach(district => {
                const count = districtCounts[district] || 0;
                const option = document.createElement('option');
                option.value = district;
                option.textContent = `${district} (${count})`;
                if (lastRegionOption) {
                    lastRegionOption.parentNode.insertBefore(option, lastRegionOption.nextSibling);
                } else {
                    select.appendChild(option);
                }
            });
        }


        // -----------------------------------------------------
        // ğŸ’¾ æœ¬åœ°ç·©å­˜åŠŸèƒ½ (ä¿æŒä¸è®Š)
        // -----------------------------------------------------
        function loadCache() {
            try {
                const cachedData = localStorage.getItem(CACHE_KEY);
                const cachedTimestampStr = localStorage.getItem(CACHE_TIMESTAMP_KEY);
                
                if (cachedData && cachedTimestampStr) {
                    ALL_NEWS_DATA = JSON.parse(cachedData);
                    
                    for (const key in ALL_NEWS_DATA) {
                        if (Array.isArray(ALL_NEWS_DATA[key])) {
                            ALL_NEWS_DATA[key] = ALL_NEWS_DATA[key].map(item => ({
                                ...item,
                                _date: new Date(item._date)
                            }));
                        }
                    }
                    
                    LAST_UPDATE_TIMESTAMP = new Date(cachedTimestampStr);

                    const timeAgo = formatRelativeTime(cachedTimestampStr);
                    const date = LAST_UPDATE_TIMESTAMP;
                    
                    const statusEl = document.getElementById('cache-status');
                    statusEl.className = 'cache-warning';
                    statusEl.innerHTML = `âš ï¸ æ•¸æ“šä¾†è‡ªæœ¬åœ°ç·©å­˜ã€‚ä¸Šæ¬¡æˆåŠŸæ›´æ–°ï¼š${timeAgo} (${date.toLocaleTimeString('zh-HK')})ã€‚`;
                    
                    document.getElementById('last-update').textContent = `æ•¸æ“šæ›´æ–°æ–¼ï¼šæœ¬åœ°ç·©å­˜ (ä¸Šæ¬¡æˆåŠŸæ™‚é–“ï¼š${date.toLocaleDateString('zh-HK')} ${date.toLocaleTimeString('zh-HK')})`;

                    console.log('Loaded data from local cache.');
                    return true;
                }
            } catch (e) {
                console.error("Error loading cache:", e);
                localStorage.removeItem(CACHE_KEY);
                localStorage.removeItem(CACHE_TIMESTAMP_KEY);
            }
            return false;
        }

        function saveCache(data) {
            try {
                const now = new Date();
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
                localStorage.setItem(CACHE_TIMESTAMP_KEY, now.toISOString());
                LAST_UPDATE_TIMESTAMP = now; 
                const statusEl = document.getElementById('cache-status');
                if (statusEl) statusEl.innerHTML = ''; 
            } catch (e) {
                console.error("Error saving cache:", e);
            }
        }


        // -----------------------------------------------------
        // æ ¸å¿ƒæ•¸æ“šè™•ç†èˆ‡æ¸²æŸ“
        // -----------------------------------------------------
        function formatRelativeTime(dateString) { 
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            const intervals = [
                { limit: 31536000, label: 'å¹´å‰' }, { limit: 2592000, label: 'å€‹æœˆå‰' },
                { limit: 86400, label: 'æ—¥å‰' }, { limit: 3600, label: 'å°æ™‚å‰' },
                { limit: 60, label: 'åˆ†é˜å‰' }, { limit: 1, label: 'ç§’å‰' }
            ];

            for (let i = 0; i < intervals.length; i++) {
                const interval = intervals[i];
                if (diffInSeconds >= interval.limit) {
                    const count = Math.floor(diffInSeconds / interval.limit);
                    return count + interval.label;
                }
            }
            return "å¹¾ç§’å‰";
        }

        async function fetchNewsForSource(sourceObj) {
            const fullQuery = `site:${sourceObj.site} ${sourceObj.querySuffix} ${BASE_KEYWORDS}`;
            const googleRssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(fullQuery)}&hl=zh-HK&gl=HK&ceid=HK:zh-Hant`;
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(googleRssUrl)}`;
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.status !== 'ok') throw new Error('API Error');

                let items = data.items.filter(item => {
                    const title = item.title;
                    
                    const hasSuicideKW = SUICIDE_KEYWORDS.some(k => title.includes(k));
                    if (!hasSuicideKW) return false; 

                    const hasExcludeKW = EXCLUDE_WORDS.some(w => title.includes(w));
                    if (hasExcludeKW) return false;

                    return true;
                });

                items = items.map(item => ({
                    ...item,
                    _status: getSuicideStatusString(item.title),
                    _date: new Date(item.pubDate).toISOString() 
                }));
                
                return items;

            } catch (error) {
                console.error(`Error fetching news for ${sourceObj.site}:`, error);
                return 'ERROR'; 
            }
        }

        function getSuicideStatusString(title) {
            const text = title;
            if (DEATH_KEYWORDS.some(k => text.includes(k))) return 'death';
            if (ATTEMPT_KEYWORDS.some(k => text.includes(k))) return 'attempt';
            return 'ambiguous';
        }
        
        async function fetchAllNewsAndCache() {
            const fetchPromises = SOURCES.map(source => fetchNewsForSource(source));
            const results = await Promise.all(fetchPromises);

            let allSuccessful = true;
            let newData = {};

            SOURCES.forEach((source, index) => {
                const result = results[index];
                if (result === 'ERROR') {
                    allSuccessful = false;
                    newData[source.id] = 'ERROR'; 
                } else {
                    newData[source.id] = result.map(item => ({
                        ...item,
                        _date: new Date(item._date) 
                    }));
                }
            });

            if (allSuccessful) {
                ALL_NEWS_DATA = newData;
                const savableData = {};
                for (const key in newData) {
                    savableData[key] = newData[key].map(item => ({
                        ...item,
                        _date: item._date.toISOString() 
                    }));
                }
                saveCache(savableData); 

                const now = new Date();
                document.getElementById('last-update').textContent = `æ•¸æ“šæ›´æ–°æ–¼ï¼š${now.toLocaleDateString('zh-HK')} ${now.toLocaleTimeString('zh-HK')}`;
                // è§¸ç™¼å…§å®¹æ·¡å…¥
                document.querySelectorAll('.news-list-content').forEach(el => el.classList.add('fade-in'));
                return true;
            } else {
                console.warn("One or more API fetches failed. Attempting to load cache...");
                return false; 
            }
        }

        function applyFilterFlash(elementId) {
            const el = document.getElementById(elementId);
            if (el) {
                el.classList.remove('flash-active');
                void el.offsetWidth; 
                el.classList.add('flash-active');
                setTimeout(() => el.classList.remove('flash-active'), 400);
            }
        }

        function updateSummaryAndCounts(totalCount) {
            const sf = document.getElementById('status-filter');
            const df = document.getElementById('district-filter');
            const so = document.getElementById('sort-order');
            const ks = document.getElementById('keyword-search');
            const summaryEl = document.getElementById('active-filters-summary');
            const summaryParts = [];

            // ç‹€æ…‹
            if (sf.value !== 'all') {
                summaryParts.push(`ç‹€æ…‹ç‚º <b>${STATUS_OPTIONS[sf.value]}</b>`);
            }
            // åœ°å€
            if (df.value !== 'all') {
                let districtText = REGION_OPTIONS[df.value] || df.options[df.selectedIndex].text.replace(/\s*\(\d+\)$/, '');
                summaryParts.push(`åœ°å€ç‚º <b>${districtText}</b>`);
            }
            // é—œéµè©
            if (ks.value.trim() !== '') {
                summaryParts.push(`åŒ…å«é—œéµè© <b>"${ks.value.trim()}"</b>`);
            }
            // æ’åº (åªæœ‰éé»˜èªæ‰é¡¯ç¤º)
            if (so.value !== 'newest') {
                summaryParts.push(`æŒ‰ <b>${so.options[so.selectedIndex].text}</b> æ’åº`);
            }

            if (summaryParts.length === 0) {
                summaryEl.textContent = 'æœªå•Ÿç”¨ç¯©é¸å™¨ã€‚æ­£åœ¨é¡¯ç¤ºæ‰€æœ‰æ•¸æ“šã€‚';
                summaryEl.classList.remove('visible');
            } else {
                let summaryText = summaryParts.join(' ä¸” ');
                summaryEl.innerHTML = `æ­£åœ¨é¡¯ç¤ºå…± <b>${totalCount} å‰‡</b>ï¼Œ${summaryText} çš„æ–°èã€‚`;
                summaryEl.classList.add('visible');
            }
        }


        function renderAllColumns(event) {
            let totalFilteredCount = 0;
            const statusFilter = document.getElementById('status-filter').value;
            const districtFilter = document.getElementById('district-filter').value; 
            const sortOrder = document.getElementById('sort-order').value;
            const keyword = document.getElementById('keyword-search').value.toLowerCase(); 

            if (event && event.target && event.target.id !== 'keyword-search' && event.target.id !== 'reset-filters-btn') {
                applyFilterFlash(event.target.id);
            }
            
            updateControlIndicators(); 

            SOURCES.forEach(source => {
                const rawItems = ALL_NEWS_DATA[source.id];
                const headerEl = document.getElementById(`header-${source.id}`);
                
                if (rawItems === 'ERROR' || !rawItems || rawItems.length === 0) {
                    document.getElementById(source.id).innerHTML = `<div class="empty">æ•¸æ“šè¼‰å…¥å¤±æ•—${rawItems === 'ERROR' ? ' (APIç¹å¿™)' : ''}æˆ–ç„¡æ•¸æ“šã€‚</div>`;
                    if (headerEl) headerEl.querySelector('.count').textContent = '0';
                    return;
                }

                let filteredItems = rawItems.filter(item => {
                    const title = item.title.toLowerCase();
                    const itemStatus = item._status;
                    const { region, district } = getDistrictTag(item.title);
                    
                    if (keyword && !title.includes(keyword)) return false;

                    if (statusFilter !== 'all' && itemStatus !== statusFilter) return false;

                    if (districtFilter !== 'all') {
                        if (['æ¸¯å³¶', 'ä¹é¾', 'æ–°ç•Œ', 'é›¢å³¶'].includes(districtFilter)) {
                            if (region !== districtFilter) return false;
                        } else if (districtFilter !== district) {
                            return false;
                        }
                    }

                    return true;
                });

                if (headerEl) {
                    headerEl.querySelector('.count').textContent = filteredItems.length;
                    totalFilteredCount += filteredItems.length;
                }

                filteredItems.sort((a, b) => {
                    return sortOrder === 'newest' ? b._date - a._date : a._date - b._date; 
                });

                renderNewsList(source.id, filteredItems, keyword);
            });
            
            updateSummaryAndCounts(totalFilteredCount);
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function renderNewsList(containerId, items, keyword) { 
            const container = document.getElementById(containerId);
            
            if (!items || items.length === 0) {
                container.innerHTML = `<div class="empty">åœ¨ç•¶å‰ç¯©é¸æ¢ä»¶ä¸‹ï¼Œç„¡ç›¸é—œå ±å°</div>`;
                container.classList.remove('fade-in'); 
                return;
            }

            const keywordRegex = keyword ? new RegExp(`(${keyword.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&')})`, 'gi') : null;
            
            let html = '<div class="news-list-content">'; 
            items.forEach(item => {
                const dateObj = item._date; 
                const pubDateStr = item.pubDate; 
                const dateStr = `${dateObj.getFullYear()}/${(dateObj.getMonth()+1).toString().padStart(2, '0')}/${dateObj.getDate().toString().padStart(2, '0')} ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;
                
                const relativeTime = formatRelativeTime(pubDateStr);
                const statusTagHtml = getSuicideStatusHtml(item._status);
                const districtTag = getDistrictTag(item.title);
                
                const isNew = LAST_UPDATE_TIMESTAMP && dateObj > LAST_UPDATE_TIMESTAMP;
                // æ³¨æ„ï¼štag-new å·²ç¶“æœ‰ background-color: var(--tag-new-bg) çš„å®šç¾©
                const newTagHtml = isNew ? '<span class="status-tag tag-new">ğŸ†• æ–°</span>' : '';

                let titleHtml = item.title;
                if (keywordRegex) {
                    titleHtml = item.title.replace(keywordRegex, '<span class="highlight-term">$1</span>');
                }

                html += `
                    <a href="${item.link}" target="_blank" class="news-item">
                        <div class="news-date">
                            <span>ç™¼ä½ˆæ™‚é–“ï¼š</span>${relativeTime} 
                            <span class="absolute-time">(${dateStr})</span>
                            ${newTagHtml}
                            ${statusTagHtml}
                            ${districtTag.html}
                        </div>
                        <div class="news-title">${titleHtml}</div>
                    </a>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
            
            container.querySelector('.news-list-content').classList.add('fade-in');
        }

        function updateControlIndicators() { 
            const sf = document.getElementById('status-filter');
            const df = document.getElementById('district-filter');
            const so = document.getElementById('sort-order');
            const ks = document.getElementById('keyword-search');
            sf.classList.toggle('active-control', sf.value !== 'all');
            df.classList.toggle('active-control', df.value !== 'all');
            so.classList.toggle('active-control', so.value !== 'newest');
            ks.classList.toggle('active-control', ks.value.trim() !== '');
        }

        function resetFilters() { 
            document.getElementById('status-filter').value = 'all';
            document.getElementById('district-filter').value = 'all';
            document.getElementById('sort-order').value = 'newest';
            document.getElementById('keyword-search').value = '';
            
            setupSearchClear(); 
            renderAllColumns();
            applyFilterFlash('reset-filters-btn');
        }

        function setupControlsToggle() {
            const toggleBtn = document.getElementById('controls-toggle-btn');
            const controlsArea = document.getElementById('controls-area');
            const isMobile = window.matchMedia("(max-width: 768px)").matches;
            
            if (isMobile) {
                controlsArea.classList.add('collapsed');
                toggleBtn.textContent = 'ğŸ”½ å±•é–‹ç¯©é¸èˆ‡æœç´¢';
            } else {
                controlsArea.classList.remove('collapsed');
                toggleBtn.style.display = 'none';
            }

            toggleBtn.addEventListener('click', () => {
                const isCollapsed = controlsArea.classList.toggle('collapsed');
                toggleBtn.textContent = isCollapsed ? 'ğŸ”½ å±•é–‹ç¯©é¸èˆ‡æœç´¢' : 'â–³ æ”¶åˆç¯©é¸èˆ‡æœç´¢';
            });
            
            window.addEventListener('resize', () => {
                const newIsMobile = window.matchMedia("(max-width: 768px)").matches;
                if (!newIsMobile) {
                    controlsArea.classList.remove('collapsed');
                    toggleBtn.style.display = 'none';
                } else {
                    toggleBtn.style.display = 'block';
                    if (!controlsArea.classList.contains('collapsed')) {
                        controlsArea.classList.add('collapsed');
                        toggleBtn.textContent = 'ğŸ”½ å±•é–‹ç¯©é¸èˆ‡æœç´¢';
                    }
                }
            });
        }


        // -----------------------------------------------------
        // ğŸš€ åˆå§‹åŒ–å‡½å¼ 
        // -----------------------------------------------------
        async function init() {
            setupDarkModeToggle();
            setupControlsToggle();
            
            const weatherElement = document.getElementById('current-weather');
            if (weatherElement) {
                weatherElement.innerHTML = 'æ™´æœ— â˜€ï¸ 24Â°C (æ•¸æ“šå¿«ç…§)';
            }
            updateDateTime();
            setInterval(updateDateTime, 1000); 

            const cacheLoaded = loadCache();
            
            SOURCES.forEach(source => renderSkeletonScreen(source.id));
            
            const success = await fetchAllNewsAndCache();

            if (!success && !cacheLoaded) {
                SOURCES.forEach(source => {
                    if (ALL_NEWS_DATA[source.id] === 'ERROR' || !ALL_NEWS_DATA[source.id]) {
                        document.getElementById(source.id).innerHTML = '<div class="error">ç¶²çµ¡æˆ–APIéŒ¯èª¤ï¼Œç„¡æ³•è¼‰å…¥æ•¸æ“šã€‚</div>';
                    }
                });
            } 
            
            populateDistrictFilter(ALL_NEWS_DATA);

            renderAllColumns(); 

            const debouncedRender = debounce(renderAllColumns, 300);
            document.getElementById('status-filter').addEventListener('change', renderAllColumns);
            document.getElementById('district-filter').addEventListener('change', renderAllColumns); 
            document.getElementById('sort-order').addEventListener('change', renderAllColumns);
            document.getElementById('keyword-search').addEventListener('input', debouncedRender);
            document.getElementById('reset-filters-btn').addEventListener('click', resetFilters);
            
            setupSearchClear();
            setupBackToTop();
        }

        window.addEventListener('load', init);

        function renderSkeletonScreen(containerId, count = 5) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; 
            
            let html = '<div class="news-list-content">';
            for (let i = 0; i < count; i++) {
                html += `
                    <div class="skeleton-item">
                        <div class="skeleton-line short"></div>
                        <div class="skeleton-line long"></div>
                        <div class="skeleton-line medium"></div>
                    </div>
                `;
            }
            html += '</div>';
            container.innerHTML = html;
        }

        function setupDarkModeToggle() {
            const toggleBtn = document.getElementById('mode-toggle');
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let currentMode = localStorage.getItem('theme');
            if (!currentMode) {
                currentMode = prefersDark ? 'dark' : 'light';
            }

            function applyMode(mode) {
                document.body.classList.toggle('dark-mode', mode === 'dark');
                toggleBtn.textContent = mode === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('theme', mode);
            }

            applyMode(currentMode);

            toggleBtn.addEventListener('click', () => {
                const newMode = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
                applyMode(newMode);
            });
        }
        
        function setupSearchClear() {
            const searchInput = document.getElementById('keyword-search');
            const clearButton = document.getElementById('clear-search-btn');
            function toggleClearButton() { clearButton.classList.toggle('visible', searchInput.value.length > 0); }
            clearButton.onclick = () => { searchInput.value = ''; toggleClearButton(); renderAllColumns(); };
            searchInput.oninput = () => toggleClearButton();
            toggleClearButton();
        }

        function setupBackToTop() {
            const backToTopBtn = document.getElementById('back-to-top-btn');
            const scrollThreshold = 300; 
            window.onscroll = () => {
                const isVisible = document.body.scrollTop > scrollThreshold || document.documentElement.scrollTop > scrollThreshold;
                backToTopBtn.classList.toggle('visible', isVisible);
            };
            backToTopBtn.onclick = () => { window.scrollTo({ top: 0, behavior: 'smooth' }); };
        }
        

    </script>
</body>
</html>