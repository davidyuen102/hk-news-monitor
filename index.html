<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æœ¬åœ°è‡ªæ®ºæ–°èç›£æ¸¬ç«™ (HK01/æ±ç¶²/æ˜Ÿå³¶ - 7æ—¥)</title>
    
    <style>
        /* --- General Reset & Typography --- */
        body {
            font-family: "PingFang TC", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f4f7f9; 
            color: #2c3e50;
            margin: 0;
            padding: 0;
            line-height: 1.6;
        }

        /* --- Alert Bar (Mandatory Safety) --- */
        .alert-bar {
            background-color: #e74c3c;
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 1rem;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        
        /* --- Header & Title --- */
        .header {
            text-align: center;
            padding: 30px 20px 20px;
            background: white;
            margin-bottom: 25px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
            position: relative; /* æ–°å¢: è¨­ç½®ç›¸å°å®šä½ï¼Œä»¥ä¾¿å®šä½å­å…ƒç´  */
        }
        .header h1 { margin: 0 0 5px 0; font-size: 2.2rem; font-weight: 800; }
        .header .meta { 
            color: #7f8c8d;
            font-size: 0.95rem;
            font-style: italic;
        }

        /* ----------------------------------- */
        /* --- å³ä¸Šè§’è³‡è¨Šå°å·¥å…·æ¨£å¼ START --- */
        /* ----------------------------------- */
        .info-widget {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            color: #34495e;
            font-size: 0.95rem;
            line-height: 1.5;
            z-index: 5;
            font-weight: 600;
        }
        .info-widget .date-time {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        .info-widget .weather {
            font-size: 0.9rem;
            color: #7f8c8d;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }
        /* ----------------------------------- */
        /* --- å³ä¸Šè§’è³‡è¨Šå°å·¥å…·æ¨£å¼ END --- */
        /* ----------------------------------- */


        /* --------------------------------- */
        /* --- ç¯©é¸èˆ‡æ’åºæ§åˆ¶é …æ¨£å¼ (ç¾ä»£åŒ–) --- */
        /* --------------------------------- */
        .controls {
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid #e0e6ed;
            border-bottom: 1px solid #e0e6ed;
            display: flex;
            justify-content: center;
            gap: 25px;
            flex-wrap: wrap;
        }

        .controls label {
            font-weight: 700;
            color: #34495e;
            margin-right: 5px;
            align-self: center;
        }

        .controls select, .controls input[type="text"] {
            padding: 10px 12px;
            border-radius: 6px; 
            border: 1px solid #c7d1da;
            background-color: white;
            font-size: 1rem;
            min-width: 130px;
            flex-grow: 1; 
            max-width: 320px;
            transition: border-color 0.2s;
        }
        .controls select:focus, .controls input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        /* --------------------------------- */


        /* --- Layout Grid --- */
        .container {
            max-width: 1400px;
            margin: 0 auto 40px;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px; 
        }

        /* --- Source Column (ç¾ä»£å¡ç‰‡æ¨£å¼) --- */
        .source-column {
            background: white;
            border-radius: 12px; 
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 20px rgba(0, 0, 0, 0.08); 
            transition: transform 0.3s ease;
        }
        
        .source-column:hover {
            transform: translateY(-3px); 
        }

        .column-header {
            padding: 18px 15px;
            color: white;
            font-weight: 700;
            font-size: 1.4rem;
            /* å•Ÿç”¨ Flexbox è®“æ–‡å­—å’Œ Emoji å±…ä¸­å°é½Š */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* åª’é«”ä¸»é¡Œè‰² */
        .header-hk01 { background-color: #34495e; } 
        .header-oncc { background-color: #f39c12; } 
        .header-singtao { background-color: #e74c3c; } 

        .news-list {
            padding: 20px;
            min-height: 250px;
        }

        /* --- News Item Card (ç°¡æ½”åˆ—è¡¨æ¨£å¼ - æ‡¸åœå¼·åŒ– START) --- */
        .news-item {
            display: block;
            padding: 15px 5px;
            margin-bottom: 12px;
            border-bottom: 1px solid #f0f0f0; 
            text-decoration: none;
            color: #2c3e50;
            /* ç¢ºä¿æœ‰éæ¸¡æ•ˆæœï¼Œè®“æ‡¸åœæ›´å¹³æ»‘ */
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            border-radius: 4px;
            /* å¢åŠ åŸºç¤é™°å½±ï¼Œè®“å¡ç‰‡æ„Ÿæ›´å¼· */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); 
        }
        
        .news-item:hover {
            background-color: #f0f0f0; /* è®“åº•è‰²è®ŠåŒ–æ›´æ˜é¡¯ */
            transform: translateY(-2px); /* è®“å¡ç‰‡çœ‹èµ·ä¾†è¢«æèµ· 2px */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12); /* æ‡¸åœæ™‚ï¼Œé™°å½±æ›´é‡ã€æ›´æ“´æ•£ */
            cursor: pointer;
        }

        .news-item:hover .news-title { 
            color: #3498db; 
            text-decoration: underline;
        }

        .news-item:last-child { border-bottom: none; margin-bottom: 0; }
        /* --- News Item Card (æ‡¸åœå¼·åŒ– END) --- */


        /* æ—¥æœŸ/æ¨™ç±¤å®¹å™¨ */
        .news-date {
            font-size: 0.9rem;
            font-weight: 600;
            color: #555;
            display: flex; 
            flex-wrap: wrap; 
            align-items: center;
            margin-bottom: 10px; 
            gap: 8px; 
        }
        
        .news-date span {
            font-weight: 600;
            color: #555;
            align-self: center;
        }
        
        /* çµ•å°æ™‚é–“æ¨£å¼ */
        .absolute-time {
            font-size: 0.85rem; 
            color: #95a5a6;
            font-weight: normal; 
        }

        /* æ¨™é¡Œ */
        .news-title {
            font-size: 1.4rem;
            font-weight: 700;
            line-height: 1.4;
            margin-top: 5px;
        }

        /* --- ç‹€æ…‹æ¨™è¨˜ (è¦–è¦ºåŒ–å„ªåŒ–) --- */
        .status-tag {
            font-size: 0.9rem;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
            white-space: nowrap;
            color: #1c1c1c; 
        }
        
        /* è‡ªæ®ºç‹€æ…‹æ¨™è¨˜ */
        .tag-death { background-color: #f7a2a2; } 
        .tag-attempt { background-color: #a4e6b7; } 
        .tag-ambiguous { background-color: #fce7a2; } 

        /* åœ°å€æ¨™è¨˜ */
        .tag-district {
            background-color: #dbe9f5; 
            color: #34495e;
            font-weight: 700;
        }
        /* åœ°å€ä¸æ˜æ¨™è¨˜ */
        .tag-unknown {
            background-color: #ecf0f1; 
            color: #7f8c8d;
        }

        .loading, .empty, .error {
            text-align: center;
            padding: 50px 20px;
            color: #95a5a6;
            font-size: 1rem;
        }
        
        /* --------------------------------- */
        /* --- éŸ¿æ‡‰å¼è¨­è¨ˆ (RWD) å„ªåŒ– --- */
        /* --------------------------------- */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 0 10px;
            }
            .header {
                padding-top: 80px; /* ç‚ºç§»å‹•ç«¯æ¨™é¡Œé¨°å‡ºç©ºé–“ */
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .news-title {
                font-size: 1.25rem;
            }
            .controls {
                flex-direction: column;
                gap: 10px;
                padding: 10px;
                align-items: flex-start;
            }
            .controls label, .controls select, .controls input[type="text"] {
                width: 100%;
                margin-right: 0;
                box-sizing: border-box;
            }
            /* RWD: å°‡è³‡è¨Šå°å·¥å…·ç½®æ–¼é ‚éƒ¨ä¸­å¤® */
            .info-widget {
                top: 15px;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                width: 90%;
            }
        }
        /* --------------------------------- */
    </style>
</head>
<body>

    <div class="alert-bar">
        âš ï¸ çæƒœç”Ÿå‘½ï¼Œè«‹å°‹æ±‚å”åŠ©ï¼š2389 2222 (é¦™æ¸¯æ’’ç‘ªåˆ©äºé˜²æ­¢è‡ªæ®ºæœƒ) | 2382 0000 (ç”Ÿå‘½ç†±ç·š)
    </div>

    <div class="header">
        
        <div class="info-widget">
            <div id="current-date-time" class="date-time">è¼‰å…¥æ™‚é–“ä¸­...</div>
            <div id="current-weather" class="weather">è¼‰å…¥å¤©æ°£ä¸­...</div>
        </div>
        <h1>é¦™æ¸¯æœ¬åœ°è‡ªæ®ºæ–°èç›£æ¸¬ç«™</h1>
        
        <div class="controls">
            <label for="status-filter">ç‹€æ…‹ç¯©é¸ï¼š</label>
            <select id="status-filter">
                <option value="all">æ‰€æœ‰ç‹€æ…‹</option>
                <option value="death">ğŸ”´ è‡ªæ®ºèº«äº¡</option>
                <option value="attempt">ğŸŸ¢ ä¼åœ–è‡ªæ®º</option>
                <option value="ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</option>
            </select>

            <label for="sort-order">æ’åºæ–¹å¼ï¼š</label>
            <select id="sort-order">
                <option value="newest">ç”±æœ€æ–°æ’åº</option>
                <option value="oldest">ç”±æœ€èˆŠæ’åº</option>
            </select>
            
            <input type="text" id="keyword-search" placeholder="ğŸ” æœç´¢æ¨™é¡Œé—œéµå­—..." title="è¼¸å…¥ä»»ä½•é—œéµå­—æœç´¢">
        </div>
        <div class="meta">
            å°ˆæ³¨æ–¼ HK01ã€æ±ç¶²ã€æ˜Ÿå³¶çªç™¼æ–°è Â· é¡¯ç¤ºæœ€è¿‘ 7 æ—¥æ•¸æ“š
            <p style="color: #c0392b; font-weight: bold; margin-top: 10px;">
                * è¨»ï¼š**ç‹€æ…‹åŠåœ°å€æ¨™è¨˜**åŸºæ–¼æ¨™é¡Œ/æ‘˜è¦é—œéµè©æ¨æ¸¬ï¼Œæº–ç¢ºæ€§é 100%ã€‚
            </p>
        </div>
        <div class="meta" id="last-update">æ­£åœ¨æº–å‚™...</div>
    </div>

    <div class="container">
        <div class="source-column">
            <div class="column-header header-singtao">
                ğŸ“° æ˜Ÿå³¶æ—¥å ± (çªç™¼å°ˆæ³¨)
            </div>
            <div id="list-singtao" class="news-list">
                <div class="loading">æœå°‹ä¸­...</div>
            </div>
        </div>

        <div class="source-column">
            <div class="column-header header-oncc">
                ğŸŒ æ±ç¶² (On.cc)
            </div>
            <div id="list-oncc" class="news-list">
                <div class="loading">æœå°‹ä¸­...</div>
            </div>
        </div>

        <div class="source-column">
            <div class="column-header header-hk01">
                ğŸ“± HK01
            </div>
            <div id="list-hk01" class="news-list">
                <div class="loading">æœå°‹ä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€è®Šé‡ï¼Œç”¨æ–¼å„²å­˜æ‰€æœ‰æ•¸æ“šï¼Œä»¥æ”¯æ´ç¯©é¸å’Œæ’åº
        let ALL_NEWS_DATA = {}; 

        // è¨­å®šæ ¸å¿ƒé—œéµå­—
        const BASE_KEYWORDS = '(è‡ªæ®º OR è¼•ç”Ÿ OR å¢®æ¨“ OR ç‡’ç‚­ OR å€’è‡¥ OR å±é«”ç™¼ç¾) (é¦™æ¸¯ OR æœ¬åœ° OR æ¸¯å³¶ OR ä¹é¾ OR æ–°ç•Œ OR é›¢å³¶) when:7d';
        const EXCLUDE_WORDS = ['æ¨“å¸‚', 'è‚¡å¸‚', 'å¤§è·Œ', 'åŠ‡é€', 'æ‹æˆ²', 'æ”¶è¦–', 'è‚¡åƒ¹', 'æˆäº¤', 'æ¥­ä¸»', 'åäºº'];

        // 1. ç‹€æ…‹åˆ¤æ–·é—œéµå­—
        const DEATH_KEYWORDS = ['èº«äº¡', 'æ–ƒå‘½', 'å±é«”', 'ä¸æ²»', 'ç•¶å ´', 'å·²è­‰å¯¦æ­»äº¡', 'è­‰å¯¦æ­»äº¡', 'äº¡', 'è¿”é­‚', 'ä¼å±', 'æ®å‘½', 'å€’æ–ƒ', 'é­‚æ–·'];
        const ATTEMPT_KEYWORDS = ['ä¼åœ–', 'ç²æ•‘', 'æ•‘å›', 'åˆ¶æ­¢', 'é€é™¢', 'å±å', 'å±ç«™'];

        // 2. åœ°å€åˆ¤æ–·é—œéµå­— (ç‚ºä¿æŒç²¾ç°¡ï¼Œé€™è£¡åªåˆ—å‡ºéƒ¨åˆ†ï¼Œè«‹ç¢ºä¿æ‚¨çš„å®Œæ•´åˆ—è¡¨å·²è¤‡è£½)
        const DISTRICT_MAP = {
            'ä¸­è¥¿': 'ä¸­è¥¿å€', 'ä¸­ç’°': 'ä¸­è¥¿å€', 'åŠå±±': 'ä¸­è¥¿å€', 'è¥¿ç‡Ÿç›¤': 'ä¸­è¥¿å€', 'ä¸Šç’°': 'ä¸­è¥¿å€', 'å …å°¼åœ°åŸ': 'ä¸­è¥¿å€', 'è¥¿ç’°': 'ä¸­è¥¿å€', 'é‡‘é˜': 'ä¸­è¥¿å€', 'èˆ¬å’¸é“': 'ä¸­è¥¿å€', 'åœ‹éš›é‡‘èä¸­å¿ƒ': 'ä¸­è¥¿å€', 'åœ‹éš›é‡‘è': 'ä¸­è¥¿å€', 'çš‡åå¤§é“': 'ä¸­è¥¿å€', 'å¾·è¼”é“': 'ä¸­è¥¿å€', 'è·ææ´»é“': 'ä¸­è¥¿å€', 'å¤ªå¹³å±±': 'ä¸­è¥¿å€',
            'ç£ä»”': 'ç£ä»”å€', 'éŠ…é‘¼ç£': 'ç£ä»”å€', 'è·‘é¦¬åœ°': 'ç£ä»”å€', 'å¤§å‘': 'å¤§å‘', 'æƒæ¡¿åŸ”': 'ç£ä»”å€', 'ç¦®é “å±±': 'ç£ä»”å€', 'å¤©å': 'ç£ä»”å€', 'å‹µå¾·é‚¨': 'ç£ä»”å€', 'å´‡å…‰': 'ç£ä»”å€', 'æœƒå±•': 'ç£ä»”å€', 'ç£ä»”è¡—å¸‚': 'ç£ä»”å€', 'çš‡åå¤§é“æ±': 'ç£ä»”å€', 'å‘Šå£«æ‰“é“': 'ç£ä»”å€',
            'æ±å€': 'æ±å€', 'åŒ—è§’': 'æ±å€', 'é°‚é­šæ¶Œ': 'æ±å€', 'ç­²ç®•ç£': 'æ±å€', 'æŸ´ç£': 'æ±å€', 'è¥¿ç£æ²³': 'æ±å€', 'æèŠ±é‚¨': 'æ±å€', 'å°è¥¿ç£': 'æ±å€', 'åº·æ€¡èŠ±åœ’': 'æ±å€', 'åº·å±±èŠ±åœ’': 'æ±å€', 'æ¼ç£é‚¨': 'æ±å€', 'ç’°ç¿ é‚¨': 'æ±å€', 'èˆˆè¯é‚¨': 'æ±å€', 'å¤ªå¤åŸ': 'æ±å€', 'é¯‰é­šé–€å…¬åœ’': 'æ±å€',
            'å—å€': 'å—å€', 'é»ƒç«¹å‘': 'å—å€', 'å¤§å£ç’°': 'å—å€', 'è–„æ‰¶æ—': 'å—å€', 'ç½®å¯Œ': 'å—å€', 'è¯å¯Œ': 'å—å€', 'è¯è²´': 'å—å€', 'é¦™æ¸¯ä»”': 'å—å€', 'ç”°ç£': 'å—å€', 'è²æ²™ç£': 'å—å€', 'æ•¸ç¢¼æ¸¯': 'å—å€', 'æ·ºæ°´ç£': 'å—å€', 'èµ¤æŸ±': 'å—å€', 'å¤§æ½­': 'å—å€', 'åˆ©æ±é‚¨': 'å—å€', 'æµ·æ€¡åŠå³¶': 'å—å€', 'æµ·æ´‹å…¬åœ’': 'å—å€', 'æ·ºæ°´ç£é“': 'å—å€',
            'æ²¹å°–æ—º': 'æ²¹å°–æ—ºå€', 'æ—ºè§’': 'æ²¹å°–æ—ºå€', 'æ²¹éº»åœ°': 'æ²¹éº»åœ°', 'å°–æ²™å’€': 'æ²¹å°–æ—ºå€', 'å¤§è§’å’€': 'æ²¹å°–æ—ºå€', 'ä½æ•¦': 'ä½æ•¦å€', 'å¥§é‹': 'æ²¹å°–æ—ºå€', 'å¯Œæ¦®èŠ±åœ’': 'æ²¹å°–æ—ºå€', 'æµ·å¯Œè‹‘': 'æ²¹å°–æ—ºå€', 'ä¸Šæµ·è¡—': 'æ²¹å°–æ—ºå€', 'å»£æ±é“': 'æ²¹å°–æ—ºå€', 'åœ“æ–¹': 'æ²¹å°–æ—ºå€', 'è¥¿ä¹é¾ç«™': 'æ²¹å°–æ—ºå€', 'å½Œæ•¦é“': 'å½Œæ•¦é“å€',
            'æ·±æ°´': 'æ·±æ°´åŸ—å€', 'é•·æ²™ç£': 'æ·±æ°´åŸ—å€', 'çŸ³ç¡¤å°¾': 'æ·±æ°´åŸ—å€', 'è”æè§’': 'æ·±æ°´åŸ—å€', 'ç¾å­š': 'æ·±æ°´åŸ—å€', 'å—å±±é‚¨': 'æ·±æ°´åŸ—å€', 'è˜‡å±‹é‚¨': 'æ·±æ°´åŸ—å€', 'ç™½ç”°é‚¨': 'æ·±æ°´åŸ—å€', 'éº—é–£é‚¨': 'éº—é–£é‚¨', 'æ¬½å·è¡—': 'æ¬½å·è¡—å€',
            'ä¹é¾åŸ': 'ä¹é¾åŸå€', 'ç´…ç£¡': 'ä¹é¾åŸå€', 'ä¹é¾å¡˜': 'ä¹é¾åŸå€', 'åœŸç“œç£': 'ä¹é¾åŸå€', 'ä½•æ–‡ç”°': 'ä¹é¾åŸå€', 'å•Ÿå¾·': 'ä¹é¾åŸå€', 'å•Ÿæ™´é‚¨': 'ä¹é¾åŸå€', 'å¾·æœ—é‚¨': 'ä¹é¾åŸå€', 'ç¿”é¾ç£': 'ä¹é¾åŸå€', 'å•Ÿå¾·æ©Ÿå ´': 'ä¹é¾åŸå€', 'å•Ÿå¾·éƒµè¼ª': 'ä¹é¾åŸå€',
            'é»ƒå¤§ä»™': 'é»ƒå¤§ä»™å€', 'æ…ˆé›²å±±': 'æ…ˆé›²å±±', 'æ¨‚å¯Œ': 'é»ƒå¤§ä»™å€', 'å½©è™¹': 'é»ƒå¤§ä»™å€', 'é‘½çŸ³å±±': 'é‘½çŸ³å±±å€', 'æ–°è’²å´—': 'é»ƒå¤§ä»™å€', 'ç«¹åœ’é‚¨': 'é»ƒå¤§ä»™å€', 'é³³å‡°æ–°é‚¨': 'é»ƒå¤§ä»™å€', 'æ–§å±±': 'é»ƒå¤§ä»™å€', 'é¾ç¿”é“': 'é»ƒå¤§ä»™å€',
            'è§€å¡˜': 'è§€å¡˜å€', 'è—ç”°': 'è§€å¡˜å€', 'æ²¹å¡˜': 'è§€å¡˜å€', 'ç§€èŒ‚åª': 'è§€å¡˜å€', 'é †åˆ©': 'è§€å¡˜å€', 'æ¨‚è¯': 'è§€å¡˜å€', 'éº—æ™¶èŠ±åœ’': 'è§€å¡˜å€', 'å•Ÿæ¥­é‚¨': 'è§€å¡˜å€', 'é †å¤©é‚¨': 'é †å¤©é‚¨', 'ç¿ å±é‚¨': 'ç¿ å±é‚¨', 'é¯‰é­šé–€': 'é¯‰é­šé–€å€', 'å‰µç´€ä¹‹åŸ': 'è§€å¡˜å€', 'è§€å¡˜ç¢¼é ­': 'è§€å¡˜å€',
            'è‘µé’': 'è‘µé’å€', 'è‘µæ¶Œ': 'è‘µé’å€', 'é’è¡£': 'é’è¡£å€', 'è”æ™¯': 'è‘µé’å€', 'è‘µç››': 'è‘µé’å€', 'è‘µèŠ³': 'è‘µèŠ³å€', 'é•·å®‰é‚¨': 'è‘µé’å€', 'é•·åº·é‚¨': 'è‘µé’å€', 'é’é¦¬å¤§æ©‹': 'è‘µé’å€', 'è²¨æ«ƒç¢¼é ­': 'è‘µé’å€',
            'èƒç£': 'èƒç£å€', 'æ±€ä¹': 'èƒç£å€', 'æ·±äº•': 'èƒç£å€', 'é¦¬ç£': 'èƒç£å€', 'éº—åŸèŠ±åœ’': 'èƒç£å€', 'æ„‰æ™¯æ–°åŸ': 'èƒç£å€', 'æ±€ä¹æ©‹': 'èƒç£å€',
            'å±¯é–€': 'å±¯é–€å€', 'å…†åº·': 'å±¯é–€å€', 'è´è¶ç£': 'å±¯é–€å€', 'å¤§èˆˆ': 'å±¯é–€å€', 'å‹æ„›é‚¨': 'å±¯é–€å€', 'å®‰å®šé‚¨': 'å±¯é–€å€', 'æ¹–æ™¯é‚¨': 'å±¯é–€å€', 'å±¯é–€ç¢¼é ­': 'å±¯é–€å€',
            'å…ƒæœ—': 'å…ƒæœ—å€', 'å¤©æ°´åœ': 'å…ƒæœ—å€', 'éŒ¦ç”°': 'å…ƒæœ—å€', 'å…«é„‰': 'å…ƒæœ—å€', 'æ–°ç”°': 'å…ƒæœ—å€', 'å±å±±': 'å…ƒæœ—å€', 'æ©«æ´²': 'å…ƒæœ—å€', 'æœ—å±é‚¨': 'å…ƒæœ—å€', 'å¤©æ‚…é‚¨': 'å…ƒæœ—å€', 'é‡‡è‘‰åº­': 'å…ƒæœ—å€', 'å…ƒæœ—å¤§é¦¬è·¯': 'å…ƒæœ—å€',
            'åŒ—å€': 'åŒ—å€', 'ä¸Šæ°´': 'åŒ—å€', 'ç²‰å¶º': 'åŒ—å€', 'æ²™é ­è§’': 'åŒ—å€', 'æ‰“é¼“å¶º': 'åŒ—å€', 'å¤æ´': 'åŒ—å€', 'è¯æ˜é‚¨': 'åŒ—å€', 'å˜‰ç¦é‚¨': 'åŒ—å€', 'æ¸…æ²³é‚¨': 'åŒ—å€',
            'å¤§åŸ”': 'å¤§åŸ”å€', 'å¤§åŸ”å¢Ÿ': 'å¤§åŸ”å€', 'å»£ç¦': 'å¤§åŸ”å€', 'ç™½çŸ³è§’': 'å¤§åŸ”å€', 'å¤§ç¾ç£': 'å¤§åŸ”å€', 'ç§‘å­¸åœ’': 'å¤§åŸ”å€', 'å¯Œå–„é‚¨': 'å¤§åŸ”å€', 'æ˜Œé‹ä¸­å¿ƒ': 'å¤§åŸ”å€', 'å¤§åŸ”æµ·æ¿±': 'å¤§åŸ”å€',
            'æ²™ç”°': 'æ²™ç”°å€', 'é¦¬éå±±': 'æ²™ç”°å€', 'å¤§åœ': 'å¤§åœå€', 'ç«ç‚­': 'æ²™ç”°å€', 'å°ç€æº': 'æ²™ç”°å€', 'åŸé–€æ²³': 'æ²™ç”°å€', 'ç€æºé‚¨': 'æ²™ç”°å€', 'ç¦¾è¼‹é‚¨': 'æ²™ç”°å€', 'å»£æºé‚¨': 'æ²™ç”°å€', 'åšåº·é‚¨': 'æ²™ç”°å€', 'æ–°åŸå¸‚å»£å ´': 'æ²™ç”°å€', 'æ²™ç”°é¦¬å ´': 'æ²™ç”°å€', 'å¨çˆ¾æ–¯é†«é™¢': 'æ²™ç”°å€',
            'è¥¿è²¢': 'è¥¿è²¢å€', 'å°‡è»æ¾³': 'å°‡è»æ¾³å€', 'å‘å£': 'å°‡è»æ¾³å€', 'èª¿æ™¯å¶º': 'å°‡è»æ¾³å€', 'å¯¶ç³': 'å°‡è»æ¾³å€', 'å°šå¾·': 'å°‡è»æ¾³å€', 'æ—¥å‡ºåº·åŸ': 'å°‡è»æ¾³å€', 'ç¿ æ—é‚¨': 'ç¿ æ—é‚¨', 'æ™¯æ—é‚¨': 'æ™¯æ—é‚¨', 'å¥æ˜é‚¨': 'å¥æ˜é‚¨', 'è¥¿è²¢ç¢¼é ­': 'è¥¿è²¢å€',
            'é›¢å³¶': 'é›¢å³¶å€', 'æ±æ¶Œ': 'é›¢å³¶å€', 'å¤§å¶¼å±±': 'é›¢å³¶å€', 'é•·æ´²': 'é›¢å³¶å€', 'å—ä¸«å³¶': 'é›¢å³¶å€', 'æ„‰æ™¯ç£': 'é›¢å³¶å€', 'åªæ´²': 'é›¢å³¶å€', 'æ¢…çª©': 'é›¢å³¶å€', 'å¤§æ¾³': 'é›¢å³¶å€', 'èµ¤é±²è§’': 'é›¢å³¶å€', 'æ©Ÿå ´': 'é›¢å³¶å€', 'é€¸æ±é‚¨': 'é›¢å³¶å€', 'æ˜‚åª': 'é›¢å³¶å€', 'å¤©å£‡å¤§ä½›': 'é›¢å³¶å€',
        };

        const SOURCES = [
            { id: 'list-hk01', site: 'hk01.com', querySuffix: '' },
            { id: 'list-oncc', site: 'on.cc', querySuffix: '' },
            { id: 'list-singtao', site: 'stheadline.com', querySuffix: 'çªç™¼' } 
        ];

        // -----------------------------------------------------
        // å‡½æ•¸ï¼šå¯¦æ™‚æ›´æ–°æœ¬åœ°æ—¥æœŸå’Œæ™‚é–“
        // -----------------------------------------------------
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                year: 'numeric', month: 'numeric', day: 'numeric', 
                weekday: 'short' 
            };
            const timeOptions = { 
                hour: '2-digit', minute: '2-digit', second: '2-digit', 
                hour12: false // ä½¿ç”¨24å°æ™‚åˆ¶
            };
            
            const dateStr = now.toLocaleDateString('zh-HK', dateOptions);
            const timeStr = now.toLocaleTimeString('zh-HK', timeOptions);

            const dateTimeElement = document.getElementById('current-date-time');
            if (dateTimeElement) {
                dateTimeElement.textContent = `${dateStr} ${timeStr}`;
            }
        }


        // -----------------------------------------------------
        // å‡½æ•¸ï¼šå°‡æ—¥æœŸè½‰æ›ç‚ºç›¸å°æ™‚é–“ (ä¾‹å¦‚ 5åˆ†é˜å‰)
        // -----------------------------------------------------
        function formatRelativeTime(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            const intervals = [
                { limit: 31536000, label: 'å¹´å‰' },
                { limit: 2592000, label: 'å€‹æœˆå‰' },
                { limit: 86400, label: 'æ—¥å‰' },
                { limit: 3600, label: 'å°æ™‚å‰' },
                { limit: 60, label: 'åˆ†é˜å‰' },
                { limit: 1, label: 'ç§’å‰' }
            ];

            for (let i = 0; i < intervals.length; i++) {
                const interval = intervals[i];
                if (diffInSeconds >= interval.limit) {
                    const count = Math.floor(diffInSeconds / interval.limit);
                    return count + interval.label;
                }
            }
            return "å¹¾ç§’å‰";
        }


        // å‡½å¼ A: åˆ¤æ–·è‡ªæ®ºç‹€æ…‹ä¸¦è¿”å›ç‹€æ…‹å­—ä¸² (ç”¨æ–¼å…§éƒ¨ç¯©é¸)
        function getSuicideStatusString(title) {
            const text = title;
            if (DEATH_KEYWORDS.some(k => text.includes(k))) {
                return 'death';
            }
            if (ATTEMPT_KEYWORDS.some(k => text.includes(k))) {
                return 'attempt';
            }
            return 'ambiguous';
        }
        
        // å‡½å¼ B: åˆ¤æ–·è‡ªæ®ºç‹€æ…‹ä¸¦è¿”å› HTML æ¨™ç±¤ (å·²åŠ å…¥åœ–æ¨™)
        function getSuicideStatusHtml(status) {
            if (status === 'death') {
                return '<span class="status-tag tag-death">ğŸ”´ è‡ªæ®ºèº«äº¡</span>';
            }
            if (status === 'attempt') {
                return '<span class="status-tag tag-attempt">ğŸŸ¢ ä¼åœ–è‡ªæ®º</span>';
            }
            return '<span class="status-tag tag-ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</span>';
        }

        // å‡½å¼ C: åˆ¤æ–·åœ°å€ä¸¦è¿”å› HTML æ¨™ç±¤
        function getDistrictTag(title) {
            const text = title;
            const sortedKeys = Object.keys(DISTRICT_MAP).sort((a, b) => b.length - a.length);

            for (const shortName of sortedKeys) {
                if (text.includes(shortName)) {
                    const districtName = DISTRICT_MAP[shortName];
                    return `<span class="status-tag tag-district">${districtName}</span>`;
                }
            }
            return '<span class="status-tag tag-district tag-unknown">åœ°å€ä¸æ˜</span>';
        }

        // å‡½å¼ D: æ¸²æŸ“å–®å€‹æ–°èåˆ—è¡¨
        function renderNewsList(containerId, items) {
            const container = document.getElementById(containerId);
            
            if (!items || items.length === 0) {
                container.innerHTML = `<div class="empty">${container.querySelector('.loading') ? 'æœå°‹ä¸­...' : 'éå» 7 æ—¥ç„¡ç›¸é—œå ±å°'}</div>`;
                return;
            }

            let html = '<div class="news-list">';
            items.forEach(item => {
                const dateObj = new Date(item.pubDate);
                // è¨ˆç®—çµ•å°æ™‚é–“ (æ ¼å¼åŒ–ç‚º YYYY/MM/DD HH:mm)
                const dateStr = `${dateObj.getFullYear()}/${(dateObj.getMonth()+1).toString().padStart(2, '0')}/${dateObj.getDate().toString().padStart(2, '0')} ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;
                
                const relativeTime = formatRelativeTime(item.pubDate);
                const statusTagHtml = getSuicideStatusHtml(item._status);
                const districtTagHtml = getDistrictTag(item.title);

                html += `
                    <a href="${item.link}" target="_blank" class="news-item">
                        <div class="news-date">
                            <span>ç™¼ä½ˆæ™‚é–“ï¼š</span>${relativeTime} 
                            <span class="absolute-time">(${dateStr})</span>
                            ${statusTagHtml}
                            ${districtTagHtml}
                        </div>
                        <div class="news-title">${item.title}</div>
                    </a>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        // å‡½å¼ E: ç²å–å–®å€‹ä¾†æºçš„æ•¸æ“š (éœ€è¦ä¾è³´ rss2json.com) - ä¿æŒä¸è®Š
        async function fetchNewsForSource(sourceObj) {
            const fullQuery = `site:${sourceObj.site} ${sourceObj.querySuffix} ${BASE_KEYWORDS}`;
            const googleRssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(fullQuery)}&hl=zh-HK&gl=HK&ceid=HK:zh-Hant`;
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(googleRssUrl)}`;
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (data.status !== 'ok') throw new Error('API Error');

                let items = data.items.filter(item => {
                    return !EXCLUDE_WORDS.some(badWord => item.title.includes(badWord));
                });

                // é è™•ç†æ•¸æ“šï¼ŒåŠ å…¥ç‹€æ…‹æ¨™ç±¤å’Œæ—¥æœŸç‰©ä»¶ï¼Œæ–¹ä¾¿å¾ŒçºŒç¯©é¸æ’åº
                items = items.map(item => ({
                    ...item,
                    _status: getSuicideStatusString(item.title),
                    _date: new Date(item.pubDate)
                }));
                
                return items;

            } catch (error) {
                console.error(error);
                return 'ERROR'; // è¿”å›éŒ¯èª¤æ¨™è¨˜
            }
        }
        
        // å‡½å¼ F: æ ¹æ“šç¯©é¸å’Œæ’åºæ¢ä»¶ï¼Œé‡æ–°æ¸²æŸ“æ‰€æœ‰æ–°èæ¬„ä½
        function renderAllColumns() {
            const statusFilter = document.getElementById('status-filter').value;
            const sortOrder = document.getElementById('sort-order').value;
            const keyword = document.getElementById('keyword-search').value.toLowerCase(); 

            SOURCES.forEach(source => {
                const rawItems = ALL_NEWS_DATA[source.id];
                
                if (rawItems === 'ERROR') {
                    document.getElementById(source.id).innerHTML = '<div class="error">æ•¸æ“šè¼‰å…¥å¤±æ•—ã€‚</div>';
                    return;
                }

                // 1. é—œéµå­—æœç´¢éæ¿¾
                let filteredItems = rawItems.filter(item => {
                    return item.title.toLowerCase().includes(keyword);
                });

                // 2. ç‹€æ…‹ç¯©é¸
                let filterValue = statusFilter.includes('death') ? 'death' : statusFilter.includes('attempt') ? 'attempt' : statusFilter.includes('ambiguous') ? 'ambiguous' : statusFilter;

                if (filterValue !== 'all') {
                    filteredItems = filteredItems.filter(item => item._status === filterValue);
                }

                // 3. æ’åº
                let sortedItems = filteredItems.sort((a, b) => {
                    if (sortOrder === 'newest') {
                        return b._date - a._date; // é™åº (æ–°åˆ°èˆŠ)
                    } else {
                        return a._date - b._date; // å‡åº (èˆŠåˆ°æ–°)
                    }
                });

                // 4. æ¸²æŸ“
                renderNewsList(source.id, sortedItems);
            });
        }


        // åˆå§‹åŒ–å‡½å¼
        async function init() {
            // è¨­ç½®éœæ…‹å¤©æ°£ä¿¡æ¯
            const weatherElement = document.getElementById('current-weather');
            if (weatherElement) {
                weatherElement.innerHTML = 'æ™´æœ— â˜€ï¸ 24Â°C (æ¿•åº¦ 45%)<br><span style="font-size: 0.8em; font-weight: 500; color: #95a5a6;">(å¤©æ°£æ•¸æ“šç‚ºå¿«ç…§)</span>';
            }
            
            // åˆå§‹åŒ–ä¸¦è¨­ç½®å®šæ™‚æ›´æ–°
            updateDateTime();
            setInterval(updateDateTime, 1000); 

            document.getElementById('last-update').innerText = 'æ­£åœ¨ç²å–ä¸¦åˆ†æä¸‰å€‹æ–°èæºçš„æ•¸æ“š...';

            const fetchPromises = SOURCES.map(source => fetchNewsForSource(source));
            const results = await Promise.all(fetchPromises);

            // å„²å­˜æ•¸æ“šåˆ°å…¨å±€è®Šé‡
            SOURCES.forEach((source, index) => {
                ALL_NEWS_DATA[source.id] = results[index];
            });
            
            // é¦–æ¬¡æ¸²æŸ“å’Œè¨­ç½®äº‹ä»¶ç›£è½å™¨
            renderAllColumns();

            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            document.getElementById('status-filter').addEventListener('change', renderAllColumns);
            document.getElementById('sort-order').addEventListener('change', renderAllColumns);
            document.getElementById('keyword-search').addEventListener('input', renderAllColumns);

            document.getElementById('last-update').innerText = 'æ›´æ–°æ™‚é–“ï¼š' + new Date().toLocaleString('zh-HK');
            
            // å®šæ™‚å™¨æ¯åˆ†é˜è‡ªå‹•åˆ·æ–°ä¸€æ¬¡åˆ—è¡¨
            setInterval(renderAllColumns, 60000); 
        }

        init();
    </script>
</body>
</html>