<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™æ¸¯æœ¬åœ°è‡ªæ®º/è‡ªæ®˜æ–°èç›£æ¸¬ç«™ (HK01/æ±ç¶²/æ˜Ÿå³¶ - 3æ—¥)</title>
    
    <style>
        /* --- General Reset & Typography --- */
        body {
            font-family: "PingFang TC", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f4f7f9; 
            color: #2c3e50;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            scroll-behavior: smooth; 
        }

        /* --- Alert Bar --- */
        .alert-bar {
            background-color: #e74c3c;
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 1rem;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
        }
        
        /* --- Header & Title --- */
        .header {
            text-align: center;
            padding: 30px 20px 20px;
            background: white;
            margin-bottom: 25px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05); 
            position: relative; 
        }
        .header h1 { margin: 0 0 5px 0; font-size: 2.2rem; font-weight: 800; }
        .header .meta { 
            color: #7f8c8d;
            font-size: 0.95rem;
            font-style: italic;
        }

        /* --- Info Widget --- */
        .info-widget {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            color: #34495e;
            font-size: 0.95rem;
            line-height: 1.5;
            z-index: 5;
            font-weight: 600;
        }
        .info-widget .date-time {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        .info-widget .weather {
            font-size: 0.9rem;
            color: #7f8c8d;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }

        /* --- Controls --- */
        .controls {
            margin: 20px 0;
            padding: 15px 0;
            border-top: 1px solid #e0e6ed;
            border-bottom: 1px solid #e0e6ed;
            display: flex;
            justify-content: center;
            align-items: center; 
            gap: 25px;
            flex-wrap: wrap;
        }

        .controls label { font-weight: 700; color: #34495e; margin-right: 5px; }
        .controls select, .controls input[type="text"] {
            padding: 10px 12px;
            border-radius: 6px; 
            border: 1px solid #c7d1da;
            background-color: white;
            font-size: 1rem;
            min-width: 130px;
            flex-grow: 1; 
            max-width: 320px;
            box-sizing: border-box;
        }
        
        .controls select.active-control, .controls input[type="text"].active-control {
            border-color: #3498db;
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.6); 
            background-color: #ecf6ff; 
        }

        .search-wrapper { position: relative; flex-grow: 1; max-width: 320px; }
        .search-wrapper input { width: 100%; }
        .clear-button {
            position: absolute; right: 10px; top: 50%; transform: translateY(-50%);
            background: none; border: none; color: #95a5a6; font-weight: bold; cursor: pointer;
            font-size: 1.2rem; visibility: hidden; 
        }
        .clear-button.visible { visibility: visible; }

        .reset-button {
            background-color: #7f8c8d; color: white; border: none; padding: 10px 15px;
            border-radius: 6px; font-size: 1rem; font-weight: 700; cursor: pointer; margin-left: 10px;
        }

        /* --- Layout --- */
        .container {
            max-width: 1400px; margin: 0 auto 40px; padding: 0 20px;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; 
        }

        .source-column {
            background: white; border-radius: 12px; overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); transition: transform 0.3s ease;
        }
        .source-column:hover { transform: translateY(-3px); }

        .column-header {
            padding: 18px 15px; color: white; font-weight: 700; font-size: 1.4rem;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        
        .header-hk01 { background-color: #34495e; } 
        .header-oncc { background-color: #f39c12; } 
        .header-singtao { background-color: #e74c3c; } 

        .news-list { padding: 20px; min-height: 250px; }

        /* --- News Item --- */
        .news-item {
            display: block; padding: 15px 5px; margin-bottom: 12px;
            border-bottom: 1px solid #f0f0f0; text-decoration: none; color: #2c3e50;
            transition: background-color 0.2s ease, transform 0.2s ease; border-radius: 4px;
        }
        .news-item:hover {
            background-color: #f0f0f0; transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
        }
        .news-item:hover .news-title { color: #3498db; text-decoration: underline; }
        
        .news-date { font-size: 0.9rem; font-weight: 600; color: #555; margin-bottom: 10px; }
        .absolute-time { font-size: 0.85rem; color: #95a5a6; font-weight: normal; }
        .news-title { font-size: 1.4rem; font-weight: 700; line-height: 1.4; margin-top: 5px; }

        .status-tag {
            font-size: 0.9rem; font-weight: 700; padding: 3px 8px; border-radius: 4px;
            white-space: nowrap; color: #1c1c1c; margin-right: 5px;
        }
        .tag-death { background-color: #f7a2a2; } 
        .tag-attempt { background-color: #a4e6b7; } 
        .tag-ambiguous { background-color: #fce7a2; } 
        .tag-district { background-color: #dbe9f5; color: #34495e; }
        .tag-unknown { background-color: #ecf0f1; color: #7f8c8d; }

        .loading, .empty, .error { text-align: center; padding: 50px 20px; color: #95a5a6; }
        
        .back-to-top {
            display: none; position: fixed; bottom: 25px; right: 25px; z-index: 99;
            background-color: #3498db; color: white; border: none; border-radius: 50%;
            width: 45px; height: 45px; font-size: 1.5rem; line-height: 45px; text-align: center;
            cursor: pointer; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .back-to-top.visible { display: block; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .header { padding-top: 80px; }
            .controls { flex-direction: column; align-items: flex-start; }
            .controls label, .controls select, .controls .search-wrapper, .controls .reset-button { width: 100%; }
            .info-widget { top: 15px; left: 50%; transform: translateX(-50%); text-align: center; width: 90%; }
        }
    </style>
</head>
<body>

    <div class="alert-bar">
        âš ï¸ çæƒœç”Ÿå‘½ï¼Œè«‹å°‹æ±‚å”åŠ©ï¼š2389 2222 (é¦™æ¸¯æ’’ç‘ªåˆ©äºé˜²æ­¢è‡ªæ®ºæœƒ) | 2382 0000 (ç”Ÿå‘½ç†±ç·š)
    </div>

    <div class="header">
        <div class="info-widget">
            <div id="current-date-time" class="date-time">è¼‰å…¥æ™‚é–“ä¸­...</div>
            <div id="current-weather" class="weather">è¼‰å…¥å¤©æ°£ä¸­...</div>
        </div>
        
        <h1>é¦™æ¸¯æœ¬åœ°è‡ªæ®º/è‡ªæ®˜æ–°èç›£æ¸¬ç«™</h1>
        
        <div class="controls">
            <label for="status-filter">ç‹€æ…‹ç¯©é¸ï¼š</label>
            <select id="status-filter" aria-label="ç¯©é¸æ–°èç‹€æ…‹">
                <option value="all">æ‰€æœ‰ç‹€æ…‹</option>
                <option value="death">ğŸ”´ è‡ªæ®ºèº«äº¡</option>
                <option value="attempt">ğŸŸ¢ ä¼åœ–/è‡ªæ®˜</option>
                <option value="ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</option>
            </select>

            <label for="sort-order">æ’åºæ–¹å¼ï¼š</label>
            <select id="sort-order" aria-label="æ–°èæ’åºæ–¹å¼">
                <option value="newest">ç”±æœ€æ–°æ’åº</option>
                <option value="oldest">ç”±æœ€èˆŠæ’åº</option>
            </select>
            
            <div class="search-wrapper">
                <input type="text" id="keyword-search" placeholder="ğŸ” æœç´¢æ¨™é¡Œé—œéµå­—..." title="è¼¸å…¥ä»»ä½•é—œéµå­—æœç´¢">
                <button type="button" id="clear-search-btn" class="clear-button">Ã—</button>
            </div>
            <button type="button" id="reset-filters-btn" class="reset-button">ğŸ§¹ é‡ç½®</button>
        </div>

        <div class="meta">
            å°ˆæ³¨æ–¼ HK01ã€æ±ç¶²ã€æ˜Ÿå³¶çªç™¼æ–°è Â· **é¡¯ç¤ºæœ€è¿‘ 3 æ—¥æ•¸æ“š**
            <p style="color: #c0392b; font-weight: bold; margin-top: 10px;">
                * è¨»ï¼šå·²æ“´å±•é—œéµè©åº«ï¼Œæ¶µè“‹å„é¡è‡ªæ®ºåŠè‡ªæ®˜ç›¸é—œå­—çœ¼ã€‚
            </p>
        </div>
        <div class="meta" id="last-update">æ­£åœ¨æº–å‚™...</div>
    </div>

    <div class="container">
        <div class="source-column">
            <div class="column-header header-singtao">ğŸ“° æ˜Ÿå³¶æ—¥å ± (çªç™¼å°ˆæ³¨)</div>
            <div id="list-singtao" class="news-list"></div>
        </div>
        <div class="source-column">
            <div class="column-header header-oncc">ğŸŒ æ±ç¶² (On.cc)</div>
            <div id="list-oncc" class="news-list"></div>
        </div>
        <div class="source-column">
            <div class="column-header header-hk01">ğŸ“± HK01</div>
            <div id="list-hk01" class="news-list"></div>
        </div>
    </div>

    <button id="back-to-top-btn" class="back-to-top">â¬†ï¸</button>

    <script>
        // å…¨å±€è®Šé‡
        let ALL_NEWS_DATA = {}; 
        
        // ==========================================================
        // ğŸš¨ æ ¸å¿ƒé—œéµè©æ“´å±• (when:3d)
        // æ¶µè“‹ï¼šè·³æ¨“ã€ç‡’ç‚­ã€æµ®å±ã€ä¸ŠåŠã€æœè—¥ã€å‰²è„ˆã€ä¼è·³ç­‰
        // ==========================================================
        const BASE_KEYWORDS = '(è‡ªæ®º OR è¼•ç”Ÿ OR å°‹æ­» OR å°‹çŸ­ OR å¢®æ¨“ OR è·³æ¨“ OR ç‡’ç‚­ OR å€’è‡¥ OR å±é«”ç™¼ç¾ OR æµ®å± OR ä¸ŠåŠ OR åŠé ¸ OR è‡ªç¸Š OR å‰²è„ˆ OR å‰²è…• OR æœæ¯’ OR åè—¥ OR é£²æ¼‚ç™½æ°´ OR ä¼è·³ OR å±ç«™ OR è‡ªæ®˜ OR è€é¼ è—¥) (é¦™æ¸¯ OR æœ¬åœ° OR æ¸¯å³¶ OR ä¹é¾ OR æ–°ç•Œ OR é›¢å³¶) when:3d';
        
        // æ’é™¤è©ï¼šé¿å…è²¡ç¶“å¤§è·Œã€å¨›æ¨‚åŠ‡é€ç­‰èª¤åˆ¤
        const EXCLUDE_WORDS = ['æ¨“å¸‚', 'è‚¡å¸‚', 'å¤§è·Œ', 'åŠ‡é€', 'æ‹æˆ²', 'æ”¶è¦–', 'è‚¡åƒ¹', 'æˆäº¤', 'æ¥­ä¸»', 'åäºº', 'è·Œå¸‚', 'å¤§ç€‰', 'æ¼”ç¿’', 'é›»å½±', 'åŠ‡é›†'];
        
        // ç‹€æ…‹åˆ†é¡é—œéµè©
        const DEATH_KEYWORDS = ['èº«äº¡', 'æ–ƒå‘½', 'å±é«”', 'ä¸æ²»', 'ç•¶å ´', 'å·²è­‰å¯¦æ­»äº¡', 'è­‰å¯¦æ­»äº¡', 'äº¡', 'è¿”é­‚', 'ä¼å±', 'æ®å‘½', 'å€’æ–ƒ', 'é­‚æ–·', 'æµ®å±', 'æººæ–ƒ', 'è‡ªç¸Š', 'åŠé ¸'];
        const ATTEMPT_KEYWORDS = ['ä¼åœ–', 'ç²æ•‘', 'æ•‘å›', 'åˆ¶æ­¢', 'é€é™¢', 'å±å', 'å±ç«™', 'è‡ªæ®˜', 'å‰²è„ˆ', 'å‰²å‚·', 'æ¸…é†’', 'åŠæ˜è¿·'];
        
        // åœ°å€åˆ¤æ–·
        const DISTRICT_MAP = {
            'ä¸­è¥¿': 'ä¸­è¥¿å€', 'ä¸­ç’°': 'ä¸­è¥¿å€', 'åŠå±±': 'ä¸­è¥¿å€', 'è¥¿ç‡Ÿç›¤': 'ä¸­è¥¿å€', 'ä¸Šç’°': 'ä¸­è¥¿å€', 'å …å°¼': 'ä¸­è¥¿å€', 'ç£ä»”': 'ç£ä»”å€', 'éŠ…é‘¼ç£': 'ç£ä»”å€', 'è·‘é¦¬åœ°': 'ç£ä»”å€', 'å¤©å': 'ç£ä»”å€', 'æ±å€': 'æ±å€', 'åŒ—è§’': 'æ±å€', 'é°‚é­šæ¶Œ': 'æ±å€', 'ç­²ç®•ç£': 'æ±å€', 'æŸ´ç£': 'æ±å€', 'æèŠ±é‚¨': 'æ±å€', 'å°è¥¿ç£': 'æ±å€', 'å¤ªå¤åŸ': 'æ±å€', 'ç‚®å°å±±': 'æ±å€', 'å—å€': 'å—å€', 'é»ƒç«¹å‘': 'å—å€', 'è–„æ‰¶æ—': 'å—å€', 'ç½®å¯Œ': 'å—å€', 'è¯å¯Œ': 'å—å€', 'é¦™æ¸¯ä»”': 'å—å€', 'ç”°ç£': 'å—å€', 'èµ¤æŸ±': 'å—å€', 'é´¨è„·æ´²': 'å—å€', 'æ·±æ°´ç£': 'å—å€', 'çŸ³æ¾³': 'å—å€', 'æ²¹å°–æ—º': 'æ²¹å°–æ—ºå€', 'æ—ºè§’': 'æ²¹å°–æ—ºå€', 'æ²¹éº»åœ°': 'æ²¹å°–æ—ºå€', 'å°–æ²™å’€': 'æ²¹å°–æ—ºå€', 'å¤§è§’å’€': 'æ²¹å°–æ—ºå€', 'ä½æ•¦': 'æ²¹å°–æ—ºå€', 'å¤ªå­': 'æ²¹å°–æ—ºå€', 'æ·±æ°´': 'æ·±æ°´åŸ—å€', 'é•·æ²™ç£': 'æ·±æ°´åŸ—å€', 'çŸ³ç¡¤å°¾': 'æ·±æ°´åŸ—å€', 'è”æè§’': 'æ·±æ°´åŸ—å€', 'ç¾å­š': 'æ·±æ°´åŸ—å€', 'å—å±±é‚¨': 'æ·±æ°´åŸ—å€', 'ä¹é¾åŸ': 'ä¹é¾åŸå€', 'ç´…ç£¡': 'ä¹é¾åŸå€', 'ä¹é¾å¡˜': 'ä¹é¾åŸå€', 'åœŸç“œç£': 'ä¹é¾åŸå€', 'ä½•æ–‡ç”°': 'ä¹é¾åŸå€', 'å•Ÿå¾·': 'ä¹é¾åŸå€', 'é»ƒå¤§ä»™': 'é»ƒå¤§ä»™å€', 'æ…ˆé›²å±±': 'é»ƒå¤§ä»™å€', 'æ¨‚å¯Œ': 'é»ƒå¤§ä»™å€', 'å½©è™¹': 'é»ƒå¤§ä»™å€', 'é‘½çŸ³å±±': 'é»ƒå¤§ä»™å€', 'æ–°è’²å´—': 'é»ƒå¤§ä»™å€', 'ç‰›æ± ç£': 'é»ƒå¤§ä»™å€', 'è§€å¡˜': 'è§€å¡˜å€', 'è—ç”°': 'è§€å¡˜å€', 'æ²¹å¡˜': 'è§€å¡˜å€', 'ç§€èŒ‚åª': 'è§€å¡˜å€', 'é †åˆ©': 'è§€å¡˜å€', 'ç‰›é ­è§’': 'è§€å¡˜å€', 'ä¹é¾ç£': 'è§€å¡˜å€', 'è‘µé’': 'è‘µé’å€', 'è‘µæ¶Œ': 'è‘µé’å€', 'é’è¡£': 'è‘µé’å€', 'è”æ™¯': 'è‘µé’å€', 'èƒç£': 'èƒç£å€', 'æ±€ä¹': 'èƒç£å€', 'æ·±äº•': 'èƒç£å€', 'é¦¬ç£': 'èƒç£å€', 'å±¯é–€': 'å±¯é–€å€', 'å…ƒæœ—': 'å…ƒæœ—å€', 'å¤©æ°´åœ': 'å…ƒæœ—å€', 'éŒ¦ç”°': 'å…ƒæœ—å€', 'åŒ—å€': 'åŒ—å€', 'ä¸Šæ°´': 'åŒ—å€', 'ç²‰å¶º': 'åŒ—å€', 'å¤§åŸ”': 'å¤§åŸ”å€', 'å¤ªå’Œ': 'å¤§åŸ”å€', 'æ²™ç”°': 'æ²™ç”°å€', 'é¦¬éå±±': 'æ²™ç”°å€', 'å¤§åœ': 'æ²™ç”°å€', 'ç«ç‚­': 'æ²™ç”°å€', 'è¥¿è²¢': 'è¥¿è²¢å€', 'å°‡è»æ¾³': 'è¥¿è²¢å€', 'å‘å£': 'è¥¿è²¢å€', 'èª¿æ™¯å¶º': 'è¥¿è²¢å€', 'å¯¶ç³': 'è¥¿è²¢å€', 'é›¢å³¶': 'é›¢å³¶å€', 'æ±æ¶Œ': 'é›¢å³¶å€', 'é•·æ´²': 'é›¢å³¶å€'
        };
        
        const SOURCES = [
            { id: 'list-hk01', site: 'hk01.com', querySuffix: '' },
            { id: 'list-oncc', site: 'on.cc', querySuffix: '' },
            { id: 'list-singtao', site: 'stheadline.com', querySuffix: 'çªç™¼' } 
        ];

        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-HK', { year: 'numeric', month: 'numeric', day: 'numeric', weekday: 'short' });
            const timeStr = now.toLocaleTimeString('zh-HK', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            const el = document.getElementById('current-date-time');
            if (el) el.textContent = `${dateStr} ${timeStr}`;
        }
        
        function updateControlIndicators() {
            const sf = document.getElementById('status-filter');
            const so = document.getElementById('sort-order');
            const ks = document.getElementById('keyword-search');
            sf.classList.toggle('active-control', sf.value !== 'all');
            so.classList.toggle('active-control', so.value !== 'newest');
            ks.classList.toggle('active-control', ks.value.trim() !== '');
        }

        function resetFilters() {
            document.getElementById('status-filter').value = 'all';
            document.getElementById('sort-order').value = 'newest';
            document.getElementById('keyword-search').value = '';
            setupSearchClear(); 
            renderAllColumns();
        }

        function setupSearchClear() {
            const input = document.getElementById('keyword-search');
            const btn = document.getElementById('clear-search-btn');
            function toggle() { btn.classList.toggle('visible', input.value.length > 0); }
            btn.onclick = () => { input.value = ''; toggle(); renderAllColumns(); };
            input.oninput = () => toggle();
            toggle();
        }
        
        function setupBackToTop() {
            const btn = document.getElementById('back-to-top-btn');
            window.onscroll = () => {
                btn.classList.toggle('visible', (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300));
            };
            btn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function formatRelativeTime(dateString) {
            const diff = Math.floor((new Date() - new Date(dateString)) / 1000);
            if (diff < 60) return "å‰›å‰›";
            if (diff < 3600) return Math.floor(diff / 60) + "åˆ†é˜å‰";
            if (diff < 86400) return Math.floor(diff / 3600) + "å°æ™‚å‰";
            return Math.floor(diff / 86400) + "æ—¥å‰";
        }

        function getSuicideStatusString(title) {
            if (DEATH_KEYWORDS.some(k => title.includes(k))) return 'death';
            if (ATTEMPT_KEYWORDS.some(k => title.includes(k))) return 'attempt';
            return 'ambiguous';
        }

        function getSuicideStatusHtml(status) {
            if (status === 'death') return '<span class="status-tag tag-death">ğŸ”´ è‡ªæ®ºèº«äº¡</span>';
            if (status === 'attempt') return '<span class="status-tag tag-attempt">ğŸŸ¢ ä¼åœ–/è‡ªæ®˜</span>';
            return '<span class="status-tag tag-ambiguous">ğŸŸ  å¾…å®š/æ¨¡ç³Š</span>';
        }
        
        function getDistrictTag(title) { 
            const keys = Object.keys(DISTRICT_MAP).sort((a, b) => b.length - a.length);
            for (const k of keys) {
                if (title.includes(k)) return `<span class="status-tag tag-district">${DISTRICT_MAP[k]}</span>`;
            }
            return '<span class="status-tag tag-district tag-unknown">åœ°å€ä¸æ˜</span>';
        }

        function renderSkeletonScreen(id) {
            document.getElementById(id).innerHTML = Array(3).fill('<div class="skeleton-item"><div class="skeleton-line short"></div><div class="skeleton-line long"></div><div class="skeleton-line medium"></div></div>').join('');
        }

        function renderNewsList(id, items) {
            const container = document.getElementById(id);
            if (!items || items.length === 0) {
                container.innerHTML = `<div class="empty">éå» 3 æ—¥ç„¡ç›¸é—œå ±å°</div>`;
                return;
            }
            let html = '<div class="news-list-content">';
            items.forEach(item => {
                const d = item._date;
                const dateStr = `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
                html += `
                    <a href="${item.link}" target="_blank" class="news-item">
                        <div class="news-date">
                            <span>${formatRelativeTime(item.pubDate)}</span>
                            <span class="absolute-time">(${dateStr})</span>
                            ${getSuicideStatusHtml(item._status)}
                            ${getDistrictTag(item.title)}
                        </div>
                        <div class="news-title">${item.title}</div>
                    </a>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func(...args), wait);
            };
        }

        async function fetchNewsForSource(sourceObj) {
            const fullQuery = `site:${sourceObj.site} ${sourceObj.querySuffix} ${BASE_KEYWORDS}`;
            const googleRssUrl = `https://news.google.com/rss/search?q=${encodeURIComponent(fullQuery)}&hl=zh-HK&gl=HK&ceid=HK:zh-Hant`;
            const apiUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(googleRssUrl)}`;
            
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();
                if (data.status !== 'ok') throw new Error('API Error');

                let items = data.items.filter(item => !EXCLUDE_WORDS.some(w => item.title.includes(w)));
                
                return items.map(item => ({
                    ...item,
                    _status: getSuicideStatusString(item.title),
                    _date: new Date(item.pubDate)
                }));
            } catch (error) {
                console.error(error);
                return 'ERROR'; 
            }
        }
        
        function renderAllColumns() {
            const sf = document.getElementById('status-filter').value;
            const so = document.getElementById('sort-order').value;
            const kw = document.getElementById('keyword-search').value.toLowerCase();
            
            updateControlIndicators();

            SOURCES.forEach(source => {
                const raw = ALL_NEWS_DATA[source.id];
                if (raw === 'ERROR') {
                    document.getElementById(source.id).innerHTML = '<div class="error">æ•¸æ“šè¼‰å…¥å¤±æ•— (RSS API ç¹å¿™)ã€‚<br>è«‹ç¨å¾Œé‡è©¦ã€‚</div>';
                    return;
                }
                if (!raw) return;

                let filtered = raw.filter(item => item.title.toLowerCase().includes(kw));
                if (sf !== 'all') filtered = filtered.filter(item => item._status === sf);
                
                filtered.sort((a, b) => so === 'newest' ? b._date - a._date : a._date - b._date);
                renderNewsList(source.id, filtered);
            });
        }

        async function init() {
            const weather = document.getElementById('current-weather');
            if (weather) weather.innerHTML = 'æ™´æœ— â˜€ï¸ 24Â°C (æ•¸æ“šå¿«ç…§)';
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            SOURCES.forEach(s => renderSkeletonScreen(s.id));

            const promises = SOURCES.map(source => fetchNewsForSource(source));
            const results = await Promise.all(promises);

            SOURCES.forEach((s, i) => ALL_NEWS_DATA[s.id] = results[i]);
            
            renderAllColumns();

            const debouncedRender = debounce(renderAllColumns, 300);
            document.getElementById('status-filter').addEventListener('change', renderAllColumns);
            document.getElementById('sort-order').addEventListener('change', renderAllColumns);
            document.getElementById('keyword-search').addEventListener('input', debouncedRender);
            document.getElementById('reset-filters-btn').addEventListener('click', resetFilters);
            
            setupSearchClear();
            setupBackToTop();
            
            const now = new Date();
            document.getElementById('last-update').textContent = `æ•¸æ“šæ›´æ–°æ–¼ï¼š${now.toLocaleDateString('zh-HK')} ${now.toLocaleTimeString('zh-HK')}`;
            
            setInterval(renderAllColumns, 60000);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>